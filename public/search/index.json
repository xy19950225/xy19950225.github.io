[{"categories":["æ–‡æ¡£"],"contents":"äº†è§£å¦‚ä½•ç®€å•é…ç½® Jupyter Notebookã€‚\nJupyter é…ç½®æ–‡ä»¶ é…ç½®æ–‡ä»¶ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯å¯ä»¥ä¿®æ”¹Jupyterå„ç§é…ç½®çš„æ–‡ä»¶ã€‚æƒ³è¦ä¿®æ”¹Jupyteré‚£äº›é»˜è®¤çš„é…ç½®é€‰é¡¹ï¼Œå°±éœ€è¦åœ¨é…ç½®æ–‡ä»¶jupyter_notebook_config.pyä¸­ä¿®æ”¹ç›¸åº”é…ç½®é€‰é¡¹çš„å±æ€§ã€‚\nè¿™ä¸ªé…ç½®æ–‡ä»¶ä¸€å¼€å§‹å¹¶ä¸å­˜åœ¨ï¼Œéœ€è¦æ‰‹åŠ¨ç”Ÿæˆã€‚æ–¹å¼å¾ˆç®€å•ï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥jupyter notebook --generate-configå¹¶æ‰§è¡Œï¼Œé…ç½®æ–‡ä»¶å°±åˆ›å»ºå¥½äº†ï¼Œå®ƒçš„ä½ç½®æ˜¯åœ¨C:\\Users\\Administrator\\.jupyter\\ä¸­ã€‚\nç„¶åæˆ‘ä»¬å»cç›˜ä¸»ç›®å½•ä¸‹æ‰“å¼€.jupyteræ–‡ä»¶å¤¹ï¼Œå°±èƒ½æ‰¾åˆ°é…ç½®æ–‡ä»¶ï¼šjupyter_notebook_config.pyé…ç½®æ–‡ä»¶æ˜¯å…³é”®ï¼Œåé¢éƒ½è¦ç”¨åˆ°çš„ã€‚\n1. æ›´æ”¹é»˜è®¤å·¥ä½œç›®å½• ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒJupyterçš„é»˜è®¤å·¥ä½œç›®å½•ä¸ºC:\\Users\\Administrator\\ï¼Œè¿™æ ·å¾ˆä¸æ¸…çˆ½ï¼Œè€Œä¸”ä¸ä¾¿äºç®¡ç†é¡¹ç›®ï¼Œæ‰€ä»¥å¸¸éœ€è¦åœ¨å…¶ä»–ç›˜å»ºç«‹ä¸€ä¸ªç‹¬ç«‹çš„Jupyterå·¥ä½œç›®å½•æ–‡ä»¶ã€‚å‰é¢æåˆ°é…ç½®æ–‡ä»¶jupyter_notebook_config.pyï¼Œå·¥ä½œç›®å½•å°±åœ¨è¿™ä¸ªé‡Œé¢ä¿®æ”¹ã€‚\n ç”¨è®°äº‹æœ¬æ‰“å¼€é…ç½®æ–‡ä»¶jupyter_notebook_config.pyï¼› Crtl + Fç»„åˆé”®æ‰¾åˆ°c.NotebookApp.notebook_dirå…ƒç´ ï¼Œåˆ æ‰å‰é¢çš„æ³¨é‡Š#ï¼› åœ¨åé¢çš„å•å¼•å·é‡Œè¾“å…¥è¦è®¾ç½®çš„ç›®å½•è·¯å¾„ï¼ˆæ³¨æ„åŒæ–œæ ï¼‰ï¼Œä¿å­˜å…³é—­ï¼›ä¾‹å¦‚ï¼šc.NotebookApp.notebook_dir = \u0026quot;E:\\\\jupyter_notebook\u0026quot; ä¿®æ”¹å¿«æ·é”®ï¼Œåœ¨winå¼€å§‹èœå•ä¸­æ‰¾åˆ°jupyter notebookå¿«æ·å›¾æ ‡ï¼Œå³å‡»é€‰æ‹©å±æ€§ï¼Œåˆ é™¤ç›®æ ‡å€¼æœ€åçš„ â€œ%USERPROFILE%/â€ï¼Œç‚¹å‡»ç¡®å®šé€€å‡ºã€‚  ç»è¿‡è¿™å››ä¸ªæ­¥éª¤ï¼Œå·¥ä½œç›®å½•å°±ä¿®æ”¹å¥½äº†ï¼Œè¿™æ—¶å€™ä¸ç®¡ä½ æ˜¯é€šè¿‡å¿«æ·é”®è¿˜æ˜¯å‘½ä»¤è¡Œè¿›å…¥Jupyter Notebookï¼Œéƒ½èƒ½çœ‹åˆ°æœ€æ–°è®¾ç½®çš„ç›®å½•ï¼Œå¹²å‡€æ¸…çˆ½ã€‚\n2.æ›´æ”¹é»˜è®¤æµè§ˆå™¨ å¾ˆå¤šå°ä¼™ä¼´æœ‰è‡ªå·±çš„æµè§ˆå™¨åå¥½ï¼Œå¸Œæœ›Jupyterè¿è¡Œåœ¨ç»å¸¸ä½¿ç”¨çš„é‚£ä¸ªæµè§ˆå™¨ä¸Šã€‚\næ›´æ”¹Jupyteré»˜è®¤æµè§ˆå™¨ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä»¥è®¾ç½®chromeæµè§ˆå™¨ä¸ºä¾‹ï¼š\n æ‰¾åˆ°chrome.exeæ–‡ä»¶çš„å®‰è£…è·¯å¾„ï¼Œå¤åˆ¶è¯¥è·¯å¾„ã€‚ä¾‹å¦‚ï¼šu'C:\\\\Program Files (x86)\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe'æŸ¥æ‰¾æ–¹å¼ï¼Ÿå³é”®chormeå›¾æ ‡ï¼Œæ‰“å¼€æ–‡ä»¶æ‰€åœ¨ä½ç½®ï¼Œå¦‚ä¸‹å›¾ï¼š  ç”¨è®°äº‹æœ¬æ‰“å¼€é…ç½®æ–‡ä»¶jupyter_notebook_config.pyï¼› Crtl + Fç»„åˆé”®æ‰¾åˆ°c.NotebookApp.browserå…ƒç´ ï¼› åœ¨æ‰¾åˆ°è®°å½•çš„ä¸‹æ–¹æ·»åŠ ä»¥ä¸‹ä»£ç ï¼ˆæ³¨æ„æ›¿æ¢ä¸ºä½ çš„chrome.exeè·¯å¾„ï¼‰ï¼š  1 2 3  import webbrowser webbrowser.register(\u0026#39;chrome\u0026#39;, None, webbrowser.GenericBrowser(u\u0026#39;C:\\\\Program Files (x86)\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\u0026#39;)) c.NotebookApp.browser = \u0026#39;chrome\u0026#39;   ä¿å­˜æ–‡ä»¶ã€‚è¿™æ ·å°±å¤§åŠŸå‘Šæˆäº†ï¼Œé‡æ–°å¯åŠ¨Jupyterï¼Œå°±ä¼šåœ¨æ–°è®¾å®šçš„æµè§ˆå™¨ä¸Šè¿è¡Œã€‚\n3. è®¾ç½®ç™»å½•å¯†ç  å‡å¦‚ä½ å¯¹è‡ªå·±çš„Jupyterç›®å½•å¾ˆæ•æ„Ÿï¼Œä¸æƒ³è®©åˆ«äººè½»æ˜“ä½¿ç”¨ï¼Œé‚£ä¹ˆå¯ä»¥è®¾ç½®ç™»å½•å¯†ç ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š\n ç”¨è®°äº‹æœ¬æ‰“å¼€é…ç½®æ–‡ä»¶jupyter_notebook_config.pyï¼› Crtl + Fç»„åˆé”®æ‰¾åˆ°c.NotebookApp.allow_password_changeå…ƒç´ ï¼Œä¿®æ”¹ä¸ºï¼šNotebookApp.allow_password_change=Falseï¼Œå¹¶ä¸”åˆ æ‰å‰é¢çš„æ³¨é‡Š#ï¼Œä¿å­˜æ–‡ä»¶ï¼› å›åˆ°windowså‘½ä»¤è¡Œï¼Œè¿è¡Œjupyter notebook passwordï¼ŒæŒ‰ç…§æç¤ºè¾“å…¥æ–°å¯†ç ï¼ˆæ³¨æ„è¿™é‡Œçš„å¯†ç æ˜¯ä¸æ˜¾ç¤ºçš„ï¼‰ï¼›   å¯ä»¥çœ‹åˆ°ä¸Šä¸€æ­¥ç”Ÿæˆäº†ä¸€ä¸ªjsonæ–‡ä»¶ï¼Œä¿å­˜åœ¨.jupyteræ–‡ä»¶å¤¹é‡Œï¼Œå’Œé…ç½®æ–‡ä»¶ä¸€ä¸ªä½ç½®ã€‚è¿™ä¸ªjsonæ–‡ä»¶ä¿å­˜äº†å¯†ç ç”Ÿæˆçš„ä¸€æ®µå“ˆå¸Œå€¼ã€‚æ‰¾åˆ°è¯¥æ–‡ä»¶å¹¶æ‰“å¼€ï¼Œå¤åˆ¶è¿™æ®µå“ˆå¸Œå€¼ã€‚ å†ä¸€æ¬¡æ‰“å¼€é…ç½®æ–‡ä»¶jupyter_notebook_config.pyï¼› Crtl + Fç»„åˆé”®æ‰¾åˆ°c.NotebookApp.passwordå…ƒç´ ï¼Œå°†å‰é¢çš„å“ˆå¸Œå€¼æ·»åŠ åˆ°åé¢ï¼Œå¹¶ä¸”åˆ æ‰å‰é¢çš„æ³¨é‡Š#ï¼Œä¿å­˜æ–‡ä»¶ï¼›ç¤ºä¾‹ï¼šc.NotebookApp.password = u'sha1:67c9e60bb8b6:9ffede0825894254b2e042ea597d771089e11aed' åˆ°è¿™é‡Œå…¨éƒ¨è®¾ç½®å¥½äº†ï¼Œé‡å¯Jupyterï¼Œå°±å¯ä»¥è¾“å…¥æ–°å¯†ç ç™»å½•ã€‚  4.å®‰è£…æ‰©å±•æ’ä»¶ Jupyterè®©å¾ˆå¤šäººå–œæ¬¢çš„åŸå› åœ¨äºå®ƒæä¾›äº†ä¸°å¯Œçš„æ’ä»¶ï¼ŒåŒ…æ‹¬æ˜¾ç¤ºä»£ç æ‰§è¡Œæ—¶é—´ã€ç”Ÿæˆç›®å½•ã€æ˜¾ç¤ºå˜é‡åã€ä»£ç å—æŠ˜å ç­‰å„ç§è®©ä½ èˆ’é€‚çš„åŠŸèƒ½ã€‚\nä½¿ç”¨æ’ä»¶å‰ï¼Œå¿…é¡»è¦å®‰è£…æ‰©å±•nbextensionsã€‚\nå…¨ç¨‹åœ¨å‘½ä»¤è¡Œå®‰è£…ï¼Œæ­¥éª¤å¦‚ä¸‹:\n å®‰è£…nbextensions æ‰§è¡Œpip install jupyter_contrib_nbextensions; å®‰è£…javascript and css files æ‰§è¡Œjupyter contrib nbextension install --user; å®‰è£…configurator æ‰§è¡Œpip install jupyter_nbextensions_configurator é‡å¯ Jupyter Notebookï¼Œ èƒ½çœ‹åˆ°nbextension æ ‡ç­¾  Conda å¸¸ç”¨å‘½ä»¤ 1. è·å–ç‰ˆæœ¬å· 1 2  conda --version conda -V   2. è·å–å¸®åŠ© 1 2  conda --help conda -h   æŸ¥çœ‹æŸä¸€å‘½ä»¤çš„å¸®åŠ©ï¼Œå¦‚updateå‘½ä»¤åŠremoveå‘½ä»¤\n1 2  conda --help update conda --help remove   3. æ›´æ–°ç®¡ç† æ›´æ–°condaï¼Œä¿æŒcondaæœ€æ–°ï¼š\n1  conda update conda   æ›´æ–°anaconda\n1  conda update anaconda   æ›´æ–°Python\n1  conda update python   å‡è®¾å½“å‰ç¯å¢ƒæ˜¯python3.6ï¼Œcondaä¼šå°†pythonå‡çº§ä¸º3.6xç³»åˆ—çš„å½“å‰æœ€æ–°ç‰ˆæœ¬\n4. ç¯å¢ƒç®¡ç† åˆ›å»ºæ–°ç¯å¢ƒ\n1  conda create -n \u0026#39;ç¯å¢ƒå\u0026#39; python=\u0026#39;ç‰ˆæœ¬å·\u0026#39;   å¸è½½ç¯å¢ƒ\n1  conda remove -n \u0026#39;ç¯å¢ƒå\u0026#39; --all   æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒ\n1  conda info -e   æ¿€æ´»æŒ‡å®šç¯å¢ƒ\n1  source activate \u0026#39;ç¯å¢ƒå\u0026#39;   é€€å‡ºå½“å‰ç¯å¢ƒ\n1  source deactivate   5. åŒ…ç®¡ç† å®‰è£…åŒ…\n1 2  conda install \u0026#39;åŒ…çš„åå­—\u0026#39; conda install \u0026#39;åŒ…çš„åå­—\u0026#39;=\u0026#39;ç‰ˆæœ¬å·\u0026#39; eg: conda install tensorflow=1.10   æ›´æ–°åŒ…\n1 2 3  conda update \u0026#39;åŒ…çš„åå­—\u0026#39; #æ›´æ–°æ‰€æœ‰åŒ… conda update --all   æœç´¢åŒ…(ç›®çš„æ˜¯æŸ¥çœ‹å¯è·å¾—çš„ç‰ˆæœ¬)\n1  conda search \u0026#39;åŒ…çš„åå­—\u0026#39; eg: conda search tensorflow   åˆ—å‡ºå½“å‰ç¯å¢ƒæ‰€æœ‰åŒ…\n1  conda list   æŸ¥çœ‹æŒ‡å®šç¯å¢ƒæ‰€æœ‰åŒ…\n1  conda list -n \u0026#39;ç¯å¢ƒå\u0026#39;   åˆ é™¤ç¯å¢ƒä¸­çš„æŸä¸ªåŒ…\n1  conda remove -n \u0026#39;ç¯å¢ƒå\u0026#39; \u0026#39;åŒ…çš„åå­—\u0026#39;   è¸©å‘ é—®é¢˜01 Jupyter Notebookï¼škernel error å·²è§£å†³ é—®é¢˜æè¿° Jupyter Notebookå‡ºç°kernel error å½“æ—¶ç”¨Anacondaå®‰è£…å¤šä¸ªç‰ˆæœ¬çš„Pythonçš„æ—¶å€™ï¼Œæ—¶å¸¸ç”±äºå®‰è£…å’Œå¸è½½å¤šæ¬¡Pythonå¯¼è‡´Juoyter notebookä¸å¯ç”¨ã€‚å¸¸å¸¸å¯¼è‡´å¦‚ä¸‹ç»“æœ\n1 2 3 4 5 6 7 8 9  Fileâ€//anaconda/lib/python2.7/site-packages/jupyter_client/manager.pyâ€, line 190, in _launch_kernel return launch_kernel(kernel_cmd, **kw) File â€œ//anaconda/lib/python2.7/site-packages/jupyter_client/launcher.pyâ€, line 123, in launch_kernel proc = Popen(cmd, **kwargs) File â€œ//anaconda/lib/python2.7/subprocess.pyâ€, line 710, in init errread, errwrite) File â€œ//anaconda/lib/python2.7/subprocess.pyâ€, line 1335, in _execute_child raise child_exception OSError: [Errno 2] No such file or director   è§£å†³æ–¹æ¡ˆ  è¿è¡Œpython -m ipykernel install --useré‡æ–°å®‰è£…å†…æ ¸ å¦‚æœæœ‰å¤šä¸ªå†…æ ¸ï¼Œå…ˆè¿è¡Œconda create -n python2 python=2ï¼Œä¸ºPython2.7è®¾ç½®Anacondaå˜é‡ï¼Œåœ¨Anacodaä¸‹ä½¿ç”¨activate pyhton2åˆ‡æ¢pythonç¯å¢ƒ é‡å¯jupyter notebookå³å¯  å°æŠ€å·§ æŸ¥çœ‹å®‰è£…çš„å†…æ ¸å’Œä½ç½®\n1  jupyter kernelspec list   è¿›å…¥å®‰è£…å†…æ ¸ç›®å½•æ‰“å¼€ kernel.json æ–‡ä»¶ï¼ŒæŸ¥çœ‹Pythonç¼–è¯‘å™¨çš„è·¯å¾„\né—®é¢˜02 å‚è€ƒ  Getting started with conda https://conda.io/projects/conda/en/latest/user-guide/getting-started.html Command reference https://docs.conda.io/projects/conda/en/latest/commands.html Anaconda é•œåƒä½¿ç”¨å¸®åŠ© https://mirrors.tuna.tsinghua.edu.cn/help/anaconda/ Condaå¸¸ç”¨å‘½ä»¤æ•´ç† https://zhengyujie.cn/2257.html Conda å¸¸ç”¨å‘½ä»¤çš„æ•´ç† https://morooi.cn/2019/anaconda/  ","permalink":"https://xy19950225.github.io/2020-11-13-jupyter-notebook-%E9%85%8D%E7%BD%AE/","tags":["Anaconda","Jupyter Notebook"],"title":"Jupyter Notebook é…ç½®"},{"categories":["åˆ·é¢˜"],"contents":"è¿™ç¯‡æ–‡ç« ä¸»è¦æ•´ç†éƒ¨åˆ† LeeCode æ•°æ®åº“ç»ƒä¹ é¢˜ã€‚\n1 å‰è¨€ æœ¬æ–‡ä¸»è¦æ•´ç† LeeCode æ•°æ®åº“ç»ƒä¹ ï¼Œå†…å®¹é€šå¸¸åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼šé¢˜ç›®ç®€è¿°ã€é‡è¦çŸ¥è¯†ç‚¹ã€è§£é¢˜æ€è·¯ã€é€»è¾‘æ­¥éª¤å’Œæ­£ç¡®çš„ SQL ä»£ç ã€‚\næœ€åå‘åœ¨è¯„è®ºåŒºåˆ†äº«ç»éªŒçš„å¹¿å¤§ç½‘å‹è‡´è°¢ï¼\n2 æ­£æ–‡ 2.1 ç®€å• 176. ç¬¬äºŒé«˜çš„è–ªæ°´  é¢˜ç›®æè¿°ï¼š\nç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œè·å– Employee è¡¨ä¸­ç¬¬äºŒé«˜çš„è–ªæ°´ï¼ˆSalaryï¼‰\n   Id Salary     1 100   2 200   3 300    ä¾‹å¦‚ä¸Šè¿° Employee è¡¨ï¼ŒSQL æŸ¥è¯¢åº”è¯¥è¿”å› 200 ä½œä¸ºç¬¬äºŒé«˜çš„è–ªæ°´ã€‚ å¦‚æœä¸å­˜åœ¨ç¬¬äºŒé«˜çš„è–ªæ°´ï¼Œé‚£ä¹ˆæŸ¥è¯¢åº”è¿”å› NULL\n   SecondHighestSalary     200    è§£é¢˜æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  # æ–¹æ³•ä¸€ï¼šä½¿ç”¨å­æŸ¥è¯¢å’Œ LIMIT å­å¥ # æ­¤æ–¹æ³•å¯é€‚ç”¨äºæ±‚ç¬¬ N é«˜çš„è–ªæ°´ï¼Œä¸”æ•°æ®è¶Šå¤æ‚ï¼Œé€Ÿåº¦ä¼˜åŠ¿è¶Šæ˜æ˜¾ SELECT (SELECT DISTINCT salary FROM employee ORDER BY salary DESC LIMIT 1,1) AS SecondHighestSalary; # æ–¹æ³•äºŒï¼šä½¿ç”¨ IFNULL å’Œ LIMIT å­å¥ SELECT IFNULL( (SELECT DISTINCT salary FROM employee ORDER BY salary DESC LIMIT 1,1),NULL) AS SecondHighestSalary; # æ–¹æ³•ä¸‰ï¼šä½¿ç”¨å­æŸ¥è¯¢å’Œ MAX() å‡½æ•° SELECT MAX(salary) AS SecondHighestSalary FROM employee WHERE salary \u0026lt; (SELECT MAX(salary) FROM employee);   596. è¶…è¿‡5åå­¦ç”Ÿçš„è¯¾  é¢˜ç›®æè¿°ï¼š\næœ‰ä¸€ä¸ª courses è¡¨ ï¼Œæœ‰ student (å­¦ç”Ÿ) å’Œ class (è¯¾ç¨‹)ï¼Œè¯·åˆ—å‡ºæ‰€æœ‰è¶…è¿‡æˆ–ç­‰äº 5 åå­¦ç”Ÿçš„è¯¾ã€‚ä¾‹å¦‚ï¼Œcourses è¡¨ï¼š\n   student class     A Math   B English   C Math   D Biology   E Math   F Computer   G Math   H Math   I Math    åº”è¯¥è¾“å‡º:\n   class     Math    æç¤ºï¼šå­¦ç”Ÿåœ¨æ¯ä¸ªè¯¾ä¸­ä¸åº”è¢«é‡å¤è®¡ç®—\nè§£é¢˜æ–¹æ³•ï¼š\n1 2 3 4 5  # æ–¹æ³•ï¼šä½¿ç”¨ GROUP BY å’Œ HAVING SELECT class FROM courses GROUP BY class HAVING COUNT(DISTINCT student) \u0026gt;=5;   197. ä¸Šå‡çš„æ¸©åº¦  é¢˜ç›®æè¿°ï¼š\nç»™å®šä¸€ä¸ª Weather è¡¨ï¼Œç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ¥æŸ¥æ‰¾ä¸ä¹‹å‰ï¼ˆæ˜¨å¤©çš„ï¼‰æ—¥æœŸç›¸æ¯”æ¸©åº¦æ›´é«˜çš„æ‰€æœ‰æ—¥æœŸçš„ Id\n   Id(INT) RecordDate(DATE) Temperature(INT)     1 2015-01-01 10   2 2015-01-02 25   3 2015-01-03 20   4 2015-01-04 30    ä¾‹å¦‚ï¼Œæ ¹æ®ä¸Šè¿°ç»™å®šçš„ Weather è¡¨æ ¼ï¼Œè¿”å›å¦‚ä¸‹ Id:\n   Id     2   4    è§£é¢˜æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12  # æ–¹æ³•ä¸€ï¼šä½¿ç”¨ JOIN å’Œ DATEDIFF() å‡½æ•° SELECT a.id AS id FROM weather a JOIN weather b ON DATEDIFF(a.recorddate,b.recorddate)=1 AND a.temperature \u0026gt; b.temperature; # æ–¹æ³•äºŒï¼šä½¿ç”¨ WHERE å’Œ DATEDIFF() å‡½æ•° SELECT a.id FROM weather a, weather b WHERE DATEDIFF(a.recorddate,b.recorddate)=1 AND a.temperature \u0026gt; b.temperature;   2.2 ä¸­ç­‰ 177. ç¬¬Né«˜çš„è–ªæ°´  é¢˜ç›®æè¿°ï¼š\nç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œè·å– Employee è¡¨ä¸­ç¬¬ n é«˜çš„è–ªæ°´ï¼ˆSalaryï¼‰\n   Id Salary     1 100   2 200   3 300    ä¾‹å¦‚ä¸Šè¿° Employee è¡¨ï¼Œn = 2 æ—¶ï¼Œåº”è¿”å›ç¬¬äºŒé«˜çš„è–ªæ°´ 200ï¼›å¦‚æœä¸å­˜åœ¨ç¬¬ n é«˜çš„è–ªæ°´ï¼Œé‚£ä¹ˆæŸ¥è¯¢åº”è¿”å› NULL\n   getNthHighestSalary(2)     200    è§£é¢˜æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11  CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT BEGIN SET N = N-1; RETURN ( # Write your MySQL query statement below. SELECT DISTINCT salary FROM employee ORDER BY salary DESC LIMIT N,1 ); END   184. éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥  é¢˜ç›®æè¿°ï¼š\nEmployee è¡¨åŒ…å«æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ï¼Œæ¯ä¸ªå‘˜å·¥æœ‰å…¶å¯¹åº”çš„ Id, Salary å’Œ DepartmentId\n   Id Name Salary DepartmentId     1 Joe 70000 1   2 Jim 90000 1   3 Henry 80000 2   4 Sam 60000 2   5 Max 90000 1    Department è¡¨åŒ…å«å…¬å¸æ‰€æœ‰éƒ¨é—¨çš„ä¿¡æ¯\n   Id Name     1 IT   2 Sales    ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ‰¾å‡ºæ¯ä¸ªéƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥ã€‚å¯¹äºä¸Šè¿°è¡¨ï¼Œæ‚¨çš„ SQL æŸ¥è¯¢åº”è¿”å›ä»¥ä¸‹è¡Œï¼ˆè¡Œçš„é¡ºåºæ— å…³ç´§è¦ï¼‰\n   Department Employee Salary     IT Max 90000   IT Jim 90000   Sales Henry 80000    è§£é‡Šï¼šMax å’Œ Jim åœ¨ IT éƒ¨é—¨çš„å·¥èµ„éƒ½æ˜¯æœ€é«˜çš„ï¼ŒHenry åœ¨é”€å”®éƒ¨çš„å·¥èµ„æœ€é«˜\nè§£é¢˜æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  # é”™è¯¯å†™æ³• SELECT d.name AS Department, e.name AS Employee, MAX(e.salary) AS Salary FROM employee e JOIN department d ON e.departmentid=d.id GROUP BY Department,Employee,Salary; # æ­£ç¡®å†™æ³• # æ–¹æ³•ï¼šä½¿ç”¨ JOIN å’Œ IN è¯­å¥ SELECT d.name AS Department, e.name AS Employee, e.salary AS Salary FROM employee e JOIN department d ON e.departmentid = d.id WHERE (e.departmentid , e.salary) IN (SELECT departmentid, MAX(salary) FROM employee GROUP BY departmentid ) ;   180. è¿ç»­å‡ºç°çš„æ•°å­—  é¢˜ç›®æè¿°ï¼š\nç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŸ¥æ‰¾æ‰€æœ‰è‡³å°‘è¿ç»­å‡ºç°ä¸‰æ¬¡çš„æ•°å­—\n   Id Num     1 1   2 1   3 1   4 2   5 1   6 2   7 2    ä¾‹å¦‚ï¼Œç»™å®šä¸Šé¢çš„ Logs è¡¨ï¼Œ 1 æ˜¯å”¯ä¸€è¿ç»­å‡ºç°è‡³å°‘ä¸‰æ¬¡çš„æ•°å­—\n   ConsecutiveNums     1    è§£é¢˜æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  # æ–¹æ³•ä¸€ï¼šç”¨ DISTINCT å’Œ WHERE è¯­å¥ SELECT DISTINCT a.num AS ConsecutiveNums FROM Logs a ,Logs b , Logs c WHERE b.id = a.id + 1 AND c.id = b.id + 1 AND b.num = a.num AND c.num = b.num; # æ–¹æ³•äºŒ: ç”¨ DISTINCT å’Œ JOIN è¯­å¥ # æ¯”æ–¹æ³•ä¸€æ‰§è¡Œé€Ÿåº¦æ›´å¿« SELECT DISTINCT a.num AS ConsecutiveNums FROM logs a LEFT JOIN logs b ON b.id = a.id + 1 LEFT JOIN logs c ON c.id = b.id + 1 WHERE b.num = a.num AND c.num = b.num; # ä¸Šè¿°ä¸¤ç§æ–¹æ³•æœ‰ç‚¹æŠ•æœºå–å·§ï¼Œå¦‚æœ ID ä¸è¿ç»­ï¼Œè¿ç»­å‡ºç° N æ¬¡ï¼Ÿ # æ–¹æ³•ä¸‰ï¼š ç”¨çª—å£å‡½æ•° ROW_NUMBER() OVER # å‚è€ƒå¤§ä½¬çš„æ€è·¯ SELECT DISTINCT num AS ConsecutiveNums FROM (SELECT num,COUNT(*) AS num_count FROM (SELECT id, num, ROW_NUMBER() OVER(ORDER BY id) - ROW_NUMBER() OVER(PARTITION BY num ORDER BY id) AS orde FROM logs ) AS w GROUP BY num,orde) AS s WHERE num_count \u0026gt;=3;   178. åˆ†æ•°æ’å  é¢˜ç›®æè¿°ï¼š\nç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢æ¥å®ç°åˆ†æ•°æ’åï¼Œå¦‚æœä¸¤ä¸ªåˆ†æ•°ç›¸åŒï¼Œåˆ™ä¸¤ä¸ªåˆ†æ•°æ’åï¼ˆRankï¼‰ç›¸åŒ\nè¯·æ³¨æ„ï¼Œå¹³åˆ†åçš„ä¸‹ä¸€ä¸ªåæ¬¡åº”è¯¥æ˜¯ä¸‹ä¸€ä¸ªè¿ç»­çš„æ•´æ•°å€¼ï¼›æ¢å¥è¯è¯´ï¼Œåæ¬¡ä¹‹é—´ä¸åº”è¯¥æœ‰â€œé—´éš”â€\n   Id Score     1 3.50   2 3.65   3 4.00   4 3.85   5 4.00   6 3.65    ä¾‹å¦‚ï¼Œæ ¹æ®ä¸Šè¿°ç»™å®šçš„ Scores è¡¨ï¼Œä½ çš„æŸ¥è¯¢åº”è¯¥è¿”å›ï¼ˆæŒ‰åˆ†æ•°ä»é«˜åˆ°ä½æ’åˆ—ï¼‰ï¼š\n   Score Rank     4.00 1   4.00 1   3.85 2   3.65 3   3.65 3   3.50 4    é‡è¦æç¤ºï¼šå¯¹äº MySQL è§£å†³æ–¹æ¡ˆï¼Œå¦‚æœè¦è½¬ä¹‰ç”¨ä½œåˆ—åçš„ä¿ç•™å­—ï¼Œå¯ä»¥åœ¨å…³é”®å­—ä¹‹å‰å’Œä¹‹åä½¿ç”¨æ’‡å·ã€‚ä¾‹å¦‚ Rank\nè§£é¢˜æ–¹æ³•ï¼š\n1 2 3 4 5  # ç”¨çª—å£å‡½æ•° DENSE_RANK() OVER() SELECT score, DENSE_RANK() OVER(ORDER BY score DESC) \u0026#39;Rank\u0026#39; FROM scores;   2.3 å›°éš¾ 185. éƒ¨é—¨å·¥èµ„å‰ä¸‰é«˜çš„æ‰€æœ‰å‘˜å·¥  é¢˜ç›®æè¿°ï¼š\nEmployee è¡¨åŒ…å«æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ï¼Œæ¯ä¸ªå‘˜å·¥æœ‰å…¶å¯¹åº”çš„å·¥å· Idï¼Œå§“å Nameï¼Œå·¥èµ„ Salary å’Œéƒ¨é—¨ç¼–å· DepartmentId\n   Id Name Salary DepartmentId     1 Joe 85000 1   2 Henry 80000 2   3 Sam 60000 2   4 Max 90000 1   5 Janet 69000 1   6 Randy 85000 1   7 Will 70000 1    Department è¡¨åŒ…å«å…¬å¸æ‰€æœ‰éƒ¨é—¨çš„ä¿¡æ¯ï¼š\n   Id Name     1 IT   2 Sales    ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ‰¾å‡ºæ¯ä¸ªéƒ¨é—¨è·å¾—å‰ä¸‰é«˜å·¥èµ„çš„æ‰€æœ‰å‘˜å·¥ã€‚ä¾‹å¦‚ï¼Œæ ¹æ®ä¸Šè¿°ç»™å®šçš„è¡¨ï¼ŒæŸ¥è¯¢ç»“æœåº”è¿”å›ï¼š\n   Department Employee Salary     IT Max 90000   IT Randy 85000   IT Joe 85000   IT Will 70000   Sales Henry 80000   Sales Sam 60000    è§£é‡Šï¼šIT éƒ¨é—¨ä¸­ï¼ŒMax è·å¾—äº†æœ€é«˜çš„å·¥èµ„ï¼ŒRandy å’Œ Joe éƒ½æ‹¿åˆ°äº†ç¬¬äºŒé«˜çš„å·¥èµ„ï¼ŒWill çš„å·¥èµ„æ’ç¬¬ä¸‰ã€‚é”€å”®éƒ¨é—¨ï¼ˆSalesï¼‰åªæœ‰ä¸¤åå‘˜å·¥ï¼ŒHenry çš„å·¥èµ„æœ€é«˜ï¼ŒSam çš„å·¥èµ„æ’ç¬¬äºŒ\nè§£é¢˜æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12  SELECT department,employee,salary FROM (SELECT d.name AS department, e.name AS employee, e.salary AS salary, e.departmentid, DENSE_RANK() OVER(PARTITION BY departmentid ORDER BY salary DESC) AS rk FROM employee e JOIN department d ON e.departmentid=d.id) AS w WHERE rk \u0026lt;= 3;   601. ä½“è‚²é¦†çš„äººæµé‡  é¢˜ç›®æè¿°ï¼š\nX å¸‚å»ºäº†ä¸€ä¸ªæ–°çš„ä½“è‚²é¦†ï¼Œæ¯æ—¥äººæµé‡ä¿¡æ¯è¢«è®°å½•åœ¨è¿™ä¸‰åˆ—ä¿¡æ¯ä¸­ï¼šåºå· (id)ã€æ—¥æœŸ (visit_date)ã€ äººæµé‡ (people)ã€‚\nè¯·ç¼–å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œæ‰¾å‡ºäººæµé‡çš„é«˜å³°æœŸã€‚é«˜å³°æœŸæ—¶ï¼Œè‡³å°‘è¿ç»­ä¸‰è¡Œè®°å½•ä¸­çš„äººæµé‡ä¸å°‘äº100ã€‚\nä¾‹å¦‚ï¼Œè¡¨ stadiumï¼š\n   id visit_date people     1 2017-01-01 10   2 2017-01-02 109   3 2017-01-03 150   4 2017-01-04 99   5 2017-01-05 145   6 2017-01-06 1455   7 2017-01-07 199   8 2017-01-08 188    å¯¹äºä¸Šé¢çš„ç¤ºä¾‹æ•°æ®ï¼Œè¾“å‡ºä¸ºï¼š\n   id visit_date people     5 2017-01-05 145   6 2017-01-06 1455   7 2017-01-07 199   8 2017-01-08 188    æç¤ºï¼š\n æ¯å¤©åªæœ‰ä¸€è¡Œè®°å½•ï¼Œæ—¥æœŸéšç€ id çš„å¢åŠ è€Œå¢åŠ ã€‚ ä½“è‚²é¦†å¹¶ä¸æ˜¯æ¯å¤©éƒ½å¼€æ”¾çš„ï¼Œæ‰€ä»¥è®°å½•ä¸­çš„æ—¥æœŸå¯èƒ½ä¼šå‡ºç°æ–­å±‚ã€‚  è§£é¢˜æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40  # æ–¹æ³•ä¸€ï¼šä½¿ç”¨åŒå±‚çª—å£å‡½æ•°ï¼Œå†…å±‚çª—å£å‡½æ•°æ±‚åˆ†ç»„ç¼–å·ï¼Œå¤–å±‚å¯¹åˆ†ç»„ç»“æœè®°å½•æ•°æ±‚å’Œ SELECT id, visit_date, people FROM (SELECT id, visit_date, people, COUNT(*) OVER(PARTITION BY a) AS b -- 3.è·å¾—åŒä¸€è¿ç»­ç»„å†…è®°å½•æ•° FROM (SELECT id, visit_date, people, id-ROW_NUMBER() OVER(ORDER BY visit_date) AS a -- 2.æŒ‰æ—¥æœŸæ’åº ç”¨id-row_numberçš„æ–¹å¼åˆ¤æ–­æ˜¯å¦è¿ç»­ FROM stadium WHERE people \u0026gt;=100) AS w) AS q -- 1.æŒ‘é€‰å‡ºäººæµè¶…è¿‡100çš„å¤©æ•° WHERE b \u0026gt;=3; # æ–¹æ³•äºŒ SELECT id, visit_date, people FROM (SELECT id, visit_date, people, LAG(people,2) OVER(ORDER BY id) AS pprvpeople, LAG(people,1) OVER(ORDER BY id) AS prvpeople, LEAD(people,1) OVER(ORDER BY id) AS nextpeople, LEAD(people,2) OVER(ORDER BY id) AS nnextpeople FROM stadium) AS people WHERE (people \u0026gt;=100 AND pprvpeople \u0026gt;=100 AND prvpeople \u0026gt;=100) OR (people \u0026gt;=100 AND prvpeople \u0026gt;=100 AND nextpeople \u0026gt;=100) OR (people \u0026gt;=100 AND nextpeople \u0026gt;=100 AND nnextpeople \u0026gt;=100);   262. è¡Œç¨‹å’Œç”¨æˆ·  é¢˜ç›®æè¿°ï¼š\nTrips è¡¨ä¸­å­˜æ‰€æœ‰å‡ºç§Ÿè½¦çš„è¡Œç¨‹ä¿¡æ¯ã€‚æ¯æ®µè¡Œç¨‹æœ‰å”¯ä¸€é”® Idï¼ŒClient_Id å’Œ Driver_Id æ˜¯ Users è¡¨ä¸­ Users_Id çš„å¤–é”®ã€‚Status æ˜¯æšä¸¾ç±»å‹ï¼Œæšä¸¾æˆå‘˜ä¸º (â€˜completedâ€™, â€˜cancelled_by_driverâ€™, â€˜cancelled_by_clientâ€™)ã€‚\n   Id Client_Id Driver_Id City_Id Status Request_at     1 1 10 1 completed 2013-10-01   2 2 11 1 cancelled_by_driver 2013-10-01   3 3 12 6 completed 2013-10-01   4 4 13 6 cancelled_by_client 2013-10-01   5 1 10 1 completed 2013-10-02   6 2 11 6 completed 2013-10-02   7 3 12 6 completed 2013-10-02   8 2 12 12 completed 2013-10-03   9 3 10 12 completed 2013-10-03   10 4 13 12 cancelled_by_driver 2013-10-03    Users è¡¨å­˜æ‰€æœ‰ç”¨æˆ·ã€‚æ¯ä¸ªç”¨æˆ·æœ‰å”¯ä¸€é”® Users_Idã€‚Banned è¡¨ç¤ºè¿™ä¸ªç”¨æˆ·æ˜¯å¦è¢«ç¦æ­¢ï¼ŒRole åˆ™æ˜¯ä¸€ä¸ªè¡¨ç¤ºï¼ˆâ€˜clientâ€™, â€˜driverâ€™, â€˜partnerâ€™ï¼‰çš„æšä¸¾ç±»å‹ã€‚\n   Users_Id Banned Role     1 No client   2 Yes client   3 No client   4 No client   10 No driver   11 No driver   12 No driver   13 No driver    å†™ä¸€æ®µ SQL è¯­å¥æŸ¥å‡º 2013 å¹´10 æœˆ1æ—¥ è‡³ 2013 å¹´10 æœˆ 3 æ—¥æœŸé—´éç¦æ­¢ç”¨æˆ·çš„å–æ¶ˆç‡ã€‚åŸºäºä¸Šè¡¨ï¼Œä½ çš„ SQL è¯­å¥åº”è¿”å›å¦‚ä¸‹ç»“æœï¼Œå–æ¶ˆç‡ï¼ˆCancellation Rateï¼‰ä¿ç•™ä¸¤ä½å°æ•°ã€‚\nå–æ¶ˆç‡çš„è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š(è¢«å¸æœºæˆ–ä¹˜å®¢å–æ¶ˆçš„éç¦æ­¢ç”¨æˆ·ç”Ÿæˆçš„è®¢å•æ•°é‡) / (éç¦æ­¢ç”¨æˆ·ç”Ÿæˆçš„è®¢å•æ€»æ•°)\n   Day Cancellation Rate     2013-10-01 0.33   2013-10-02 0.00   2013-10-03 0.50    è§£é¢˜æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  SELECT T.request_at AS `Day`, ROUND( SUM( IF(T.STATUS = \u0026#39;completed\u0026#39;,0,1) ) / COUNT(T.STATUS), 2 ) AS `Cancellation Rate` FROM Trips AS T JOIN Users AS U1 ON (T.client_id = U1.users_id AND U1.banned =\u0026#39;No\u0026#39;) JOIN Users AS U2 ON (T.driver_id = U2.users_id AND U2.banned =\u0026#39;No\u0026#39;) WHERE T.request_at BETWEEN \u0026#39;2013-10-01\u0026#39; AND \u0026#39;2013-10-03\u0026#39; GROUP BY T.request_at   3 æ€»ç»“ é€šè¿‡è¿™ä¸€æ®µæ—¶é—´çš„ç»ƒä¹ åŸºæœ¬ç†Ÿæ‚‰äº† SQL çš„å¸¸ç”¨è¯­å¥ï¼ŒJOIN è¯­å¥å’Œçª—å£å‡½æ•°åœ¨ SQL ä¸­çš„é‡è¦æ€§ä¸è¨€è€Œå–» ã€‚åé¢æˆ‘å°†ç»§ç»­å­¦ä¹  SQL ä¸­çš„çª—å£å‡½æ•°å’Œ JOIN è¯­å¥ï¼ŒLet\u0026rsquo;s go !ğŸ˜€\n","permalink":"https://xy19950225.github.io/2020-11-13-sql-%E5%8A%9B%E6%89%A3%E7%BB%83%E4%B9%A0/","tags":["LeeCode","SQL"],"title":"SQL åŠ›æ‰£ç»ƒä¹ "},{"categories":["æŠ€æœ¯"],"contents":"äº†è§£å¦‚ä½•ä½¿ç”¨ SQL çª—å£å‡½æ•°ã€‚\næ›´æ–°è¯´æ˜  2020-10-10 æ–°å¢ ä½¿ç”¨ Hive SQL çš„çª—å£å‡½æ•°è¿›è¡Œå•†åŠ¡æ•°æ®åˆ†æ 2020-10-01 æ–°å¢ MySQL çª—å£å‡½æ•° 2020-10-01 ä¿®è®¢ éƒ¨åˆ†æ–‡å­—å’Œæ’ç‰ˆ\n  \r1. çª—å£å‡½æ•°çš„ç®€ä»‹ çª—å£å‡½æ•°æ˜¯ä¸ºäº†å®ç° OLAP è€Œæ·»åŠ çš„æ ‡å‡† SQL åŠŸèƒ½ï¼Œä¹Ÿç§°ä¸º OLAP å‡½æ•°ï¼ˆOnLine Analytical Processing çš„ç®€ç§°ï¼ŒæŒ‡ è”æœºåˆ†æå¤„ç† ï¼‰ï¼Œå…¶ä½œç”¨æ˜¯å°†è¡¨ä»¥çª—å£ä¸ºå•ä½è¿›è¡Œåˆ†å‰²ï¼Œå¹¶åœ¨å…¶ä¸­è¿›è¡Œæ’åºã€‚\nğŸ˜˜æ³¨æ„ï¼šä» MySQL 8.0 å¼€å§‹æ”¯æŒçª—å£å‡½æ•°ã€‚\nçª—å£å‡½æ•°å’Œæ™®é€šèšåˆå‡½æ•°å¾ˆå®¹æ˜“æ··æ·†ï¼ŒäºŒè€…åŒºåˆ«å¦‚ä¸‹ï¼š\n èšåˆå‡½æ•°æ˜¯å°†å¤šæ¡è®°å½•èšåˆä¸ºä¸€æ¡ï¼›è€Œçª—å£å‡½æ•°æ˜¯æ¯æ¡è®°å½•éƒ½ä¼šæ‰§è¡Œï¼Œæœ‰å‡ æ¡è®°å½•æ‰§è¡Œå®Œè¿˜æ˜¯å‡ æ¡ã€‚ èšåˆå‡½æ•°ä¹Ÿå¯ä»¥ç”¨äºçª—å£å‡½æ•°ä¸­ã€‚  2. çª—å£å‡½æ•°çš„è¯­æ³• 1 2  # [] ä¸­çš„å†…å®¹å¯ä»¥çœç•¥ \u0026lt;çª—å£å‡½æ•°\u0026gt; OVER ([PARTITION BY \u0026lt;åˆ—æ¸…å•\u0026gt;] ORDER BY \u0026lt;æ’åºç”¨åˆ—æ¸…å•\u0026gt;)   å°ç»“ï¼šçª—å£å‡½æ•°å…¼å…·åˆ†ç»„å’Œæ’åºä¸¤ç§åŠŸèƒ½ï¼Œé€šè¿‡ PARTITION BY åˆ†ç»„åçš„è®°å½•é›†åˆç§°ä¸ºâ€œçª—å£â€ï¼ŒPARTITION BY è®¾å®šæ’åºçš„å¯¹è±¡èŒƒå›´ï¼ŒORDER BY æŒ‡å®šæŒ‰ç…§å“ªä¸€åˆ—ã€ä½•ç§é¡ºåºè¿›è¡Œæ’åºã€‚\nè¯´æ˜ï¼š PARTITION BY å’Œ GROUP BY çš„åŒºåˆ« ï¼Ÿ\nPARTITION BY è¿”å›åˆ†ç»„é‡Œçš„æ¯ä¸€è¡Œæ•°æ®ï¼ŒGROUP BY è¿”å›åˆ†ç»„é‡Œçš„ä»…ä¸€è¡Œæ•°æ®\n3. çª—å£å‡½æ•°çš„ç±»å‹ ä¸€èˆ¬æŒ‰ç…§åŠŸèƒ½åˆ’åˆ†å¯å°†çª—å£å‡½æ•°åˆ†ä¸ºèšåˆçª—å£å‡½æ•°å’Œä¸“é—¨çª—å£å‡½æ•°ï¼ˆå¦‚æ’åçª—å£å‡½æ•°ï¼‰ã€‚\n3.1 èšåˆçª—å£å‡½æ•°  ä»¥å½“å‰è®°å½•ä½œä¸ºåŸºå‡†è¿›è¡Œç´¯è®¡ï¼Œæ˜¯èšåˆçª—å£å‡½æ•°çš„æœ€å¤§ç‰¹å¾\n æŒ‡å®š â€œæœ€é è¿‘çš„ 3 è¡Œâ€ ä½œä¸ºæ±‡æ€»å¯¹è±¡ï¼Œè¾“å…¥ä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š\n1 2 3 4  # æŒ‡å®š â€œæœ€é è¿‘çš„ 3 è¡Œâ€ ä½œä¸ºæ±‡æ€»å¯¹è±¡ SELECT product_id, product_name, sale_price, AVG (sale_price) OVER (ORDER BY product_id ROWS 2 PRECEDING) AS moving_avg FROM Product;   å…¶ç»“æœè¾“å‡ºï¼š\n   product_id product_name sale_price moving_avg     0001 Tæ¤è¡« 1000 1000   0002 æ‰“å­”å™¨ 500 750   0003 è¿åŠ¨Tæ¤ 4000 1833   0004 èœåˆ€ 3000 2500   0005 é«˜å‹é”… 6800 4600   0006 å‰å­ 500 3433   0007 æ“¦èœæ¿ 880 2726   0008 åœ†ç ç¬” 100 493    å°†å½“å‰è®°å½•çš„å‰åè¡Œä½œä¸ºæ±‡æ€»å¯¹è±¡ï¼ŒSQL è¯­å¥å¦‚ä¸‹ï¼š\n1 2 3 4 5  # å°†å½“å‰è®°å½•çš„å‰åè¡Œä½œä¸ºæ±‡æ€»å¯¹è±¡ SELECT product_id, product_name, sale_price, AVG(sale_price) OVER(ORDER BY product_id ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) AS moving_avg FROM Product;   è¾“å‡ºç»“æœï¼š\n   product_id product_name sale_price moving_avg     0001 Tæ¤è¡« 1000 750   0002 æ‰“å­”å™¨ 500 1833   0003 è¿åŠ¨Tæ¤ 4000 2500   0004 èœåˆ€ 3000 4600   0005 é«˜å‹é”… 6800 3433   0006 å‰å­ 500 2726   0007 æ“¦èœæ¿ 880 493   0008 åœ†ç ç¬” 100 490    ğŸ˜€è¯´æ˜ï¼šROWS æŒ‡å®šæ¡†æ¶ï¼ŒPRECEDING å°†æ¡†æ¶æŒ‡å®šä¸ºâ€œæˆªæ­¢åˆ°ä¹‹å‰ ~ è¡Œâ€ï¼ŒFOLLOWING å°†æ¡†æ¶æŒ‡å®šä¸ºâ€œæˆªæ­¢åˆ°ä¹‹å ~ è¡Œâ€\n3.2 æ’åçª—å£å‡½æ•° æ’åçª—å£å‡½æ•°æµ‹è¯•ä»£ç ï¼š\n1 2 3 4 5  SELECT product_name, product_type, sale_price, RANK () OVER (ORDER BY sale_price) AS ranking, DENSE_RANK () OVER (ORDER BY sale_price) AS dense_ranking, ROW_NUMBER () OVER (ORDER BY sale_price) AS row_num FROM Product;   ç»“æœè¾“å‡ºï¼š\n   product_name product_type sale_price ranking dense_ranking row_num     åœ†ç ç¬” åŠå…¬ç”¨å“ 100 1 1 1   å‰å­ å¨æˆ¿ç”¨å…· 500 2 2 2   æ‰“å­”å™¨ åŠå…¬ç”¨å“ 500 2 2 3   æ“¦èœæ¿ å¨æˆ¿ç”¨å…· 880 4 3 4   Tæ¤è¡« è¡£æœ 1000 5 4 5   èœåˆ€ å¨æˆ¿ç”¨å…· 3000 6 5 6   è¿åŠ¨Tæ¤ è¡£æœ 4000 7 6 7   é«˜å‹é”… å¨æˆ¿ç”¨å…· 6800 8 7 8    3.3 MySQL æ”¯æŒçš„çª—å£å‡½æ•° æŒ‰ç…§åŠŸèƒ½åˆ’åˆ†ï¼Œå¯ä»¥æŠŠ MySQL æ”¯æŒçš„çª—å£å‡½æ•°åˆ†ä¸ºå¦‚ä¸‹å‡ ç±»ï¼š\n åºå·å‡½æ•°ï¼šrow_number () /rank () /dense_rank () åˆ†å¸ƒå‡½æ•°ï¼špercent_rank () /cume_dist () å‰åå‡½æ•°ï¼šlag () /lead () å¤´å°¾å‡½æ•°ï¼šfirst_val () /last_val () å…¶ä»–å‡½æ•°ï¼šnth_value () /nfile ()  åˆ†å¸ƒå‡½æ•° cume_dist ()\nç”¨é€”ï¼šåˆ†ç»„å†…å¤§äºç­‰äºå½“å‰ rank å€¼çš„è¡Œæ•° / åˆ†ç»„å†…æ€»è¡Œæ•°ã€‚\nåº”ç”¨åœºæ™¯ï¼šå¤§äºç­‰äºå½“å‰è®¢å•é‡‘é¢çš„è®¢å•æ¯”ä¾‹æœ‰å¤šå°‘ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  select rank() over w as row_num, cume_dist() over w as percent, order_id,user_no,amount,create_date from order_info window w as (partition by user_no order by amount desc); +---------+---------+----------+---------+--------+---------------------+ | row_num | percent | order_id | user_no | amount | create_date | +---------+---------+----------+---------+--------+---------------------+ | 1 | 0.2 | 5 | u0001 | 900 | 2018-01-20 00:00:00 | | 2 | 0.4 | 4 | u0001 | 800 | 2018-01-10 00:00:00 | | 3 | 0.8 | 2 | u0001 | 300 | 2018-01-02 00:00:00 | | 3 | 0.8 | 3 | u0001 | 300 | 2018-01-02 00:00:00 | | 5 | 1 | 1 | u0001 | 100 | 2018-01-01 00:00:00 | | 1 | 0.4 | 9 | u0002 | 800 | 2018-01-16 00:00:00 | | 1 | 0.4 | 10 | u0002 | 800 | 2018-01-22 00:00:00 | | 3 | 0.6 | 7 | u0002 | 600 | 2018-01-06 00:00:00 | | 4 | 0.8 | 6 | u0002 | 500 | 2018-01-05 00:00:00 | | 5 | 1 | 8 | u0002 | 300 | 2018-01-10 00:00:00 | +---------+---------+----------+---------+--------+---------------------+   å‰åå‡½æ•° lag ()ã€lead ()\nç”¨é€”ï¼š\n lag (column,n) è·å–å½“å‰æ•°æ®è¡ŒæŒ‰ç…§æŸç§æ’åºè§„åˆ™çš„ä¸Š n è¡Œæ•°æ®çš„æŸä¸ªå­—æ®µ lead (column,n) è·å–å½“å‰æ•°æ®è¡ŒæŒ‰ç…§æŸç§æ’åºè§„åˆ™çš„ä¸‹ n è¡Œæ•°æ®çš„æŸä¸ªå­—æ®µ  åº”ç”¨åœºæ™¯ï¼šæŒ‰ç…§æ—¶é—´æ’åºï¼Œè·å–å½“å‰è®¢å•çš„ä¸Šä¸€ç¬”è®¢å•å‘ç”Ÿæ—¶é—´å’Œä¸‹ä¸€ç¬”è®¢å•å‘ç”Ÿæ—¶é—´ï¼Œï¼ˆå¯ä»¥è®¡ç®—è®¢å•çš„æ—¶é—´ä¸Šçš„é—´éš”åº¦æˆ–è€…è¯´ä¹°ä¹°ä¹°çš„é¢‘ç¹ç¨‹åº¦ï¼‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  select order_id,user_no,amount,create_date, lag(create_date,1) over w \u0026#39;last_transaction_time\u0026#39;, lead(create_date,1) over w \u0026#39;next_transaction_time\u0026#39; from order_info window w as (partition by user_no order by create_date asc); +----------+---------+--------+---------------------+-----------------------+-----------------------+ | order_id | user_no | amount | create_date | last_transaction_time | next_transaction_time | +----------+---------+--------+---------------------+-----------------------+-----------------------+ | 1 | u0001 | 100 | 2018-01-01 00:00:00 | NULL | 2018-01-02 00:00:00 | | 2 | u0001 | 300 | 2018-01-02 00:00:00 | 2018-01-01 00:00:00 | 2018-01-02 00:00:00 | | 3 | u0001 | 300 | 2018-01-02 00:00:00 | 2018-01-02 00:00:00 | 2018-01-10 00:00:00 | | 4 | u0001 | 800 | 2018-01-10 00:00:00 | 2018-01-02 00:00:00 | 2018-01-20 00:00:00 | | 5 | u0001 | 900 | 2018-01-20 00:00:00 | 2018-01-10 00:00:00 | NULL | | 6 | u0002 | 500 | 2018-01-05 00:00:00 | NULL | 2018-01-06 00:00:00 | | 7 | u0002 | 600 | 2018-01-06 00:00:00 | 2018-01-05 00:00:00 | 2018-01-10 00:00:00 | | 8 | u0002 | 300 | 2018-01-10 00:00:00 | 2018-01-06 00:00:00 | 2018-01-16 00:00:00 | | 9 | u0002 | 800 | 2018-01-16 00:00:00 | 2018-01-10 00:00:00 | 2018-01-22 00:00:00 | | 10 | u0002 | 800 | 2018-01-22 00:00:00 | 2018-01-16 00:00:00 | NULL | +----------+---------+--------+---------------------+-----------------------+-----------------------+   å¤´å°¾å‡½æ•° first_value ()ã€last_value ()\nç”¨é€”ï¼šå¤´å°¾å‡½æ•°å¯ä»¥å¾—åˆ°åˆ†åŒºä¸­çš„ç¬¬ä¸€ä¸ª / æœ€åä¸€ä¸ªæŒ‡å®šå‚æ•°çš„å€¼ã€‚\nåº”ç”¨åœºæ™¯ï¼šæŸ¥è¯¢æˆªæ­¢åˆ°å½“å‰è®¢å•ï¼ŒæŒ‰ç…§æ—¥æœŸæ’åºç¬¬ä¸€ä¸ªè®¢å•å’Œæœ€åä¸€ä¸ªè®¢å•çš„è®¢å•é‡‘é¢ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  select order_id,user_no,amount,create_date, first_value(create_date) over w \u0026#39;first_transaction_time\u0026#39;, last_value(create_date) over w \u0026#39;last_transaction_time\u0026#39; from order_info window w as (partition by user_no order by create_date asc); +----------+---------+--------+---------------------+------------------------+-----------------------+ | order_id | user_no | amount | create_date | first_transaction_time | last_transaction_time | +----------+---------+--------+---------------------+------------------------+-----------------------+ | 1 | u0001 | 100 | 2018-01-01 00:00:00 | 2018-01-01 00:00:00 | 2018-01-01 00:00:00 | | 2 | u0001 | 300 | 2018-01-02 00:00:00 | 2018-01-01 00:00:00 | 2018-01-02 00:00:00 | | 3 | u0001 | 300 | 2018-01-02 00:00:00 | 2018-01-01 00:00:00 | 2018-01-02 00:00:00 | | 4 | u0001 | 800 | 2018-01-10 00:00:00 | 2018-01-01 00:00:00 | 2018-01-10 00:00:00 | | 5 | u0001 | 900 | 2018-01-20 00:00:00 | 2018-01-01 00:00:00 | 2018-01-20 00:00:00 | | 6 | u0002 | 500 | 2018-01-05 00:00:00 | 2018-01-05 00:00:00 | 2018-01-05 00:00:00 | | 7 | u0002 | 600 | 2018-01-06 00:00:00 | 2018-01-05 00:00:00 | 2018-01-06 00:00:00 | | 8 | u0002 | 300 | 2018-01-10 00:00:00 | 2018-01-05 00:00:00 | 2018-01-10 00:00:00 | | 9 | u0002 | 800 | 2018-01-16 00:00:00 | 2018-01-05 00:00:00 | 2018-01-16 00:00:00 | | 10 | u0002 | 800 | 2018-01-22 00:00:00 | 2018-01-05 00:00:00 | 2018-01-22 00:00:00 | +----------+---------+--------+---------------------+------------------------+-----------------------+   ğŸ˜±æ³¨æ„ï¼šå¦‚æœä¸åŠ  order by, å°±æ²¡æœ‰çª—å£ï¼Œè®¡ç®—èŒƒå›´æ˜¯æ•´ä¸ªåˆ†åŒºï¼›å¦‚æœåŠ ä¸Š order by, é»˜è®¤çª—å£æ˜¯ range between unbounded preceding and current rowï¼Œå°±æ˜¯æ’åºåä»åˆ†åŒºç¬¬ä¸€è¡Œä¸€ç›´åˆ°å½“å‰è¡Œä¸ºæ­¢ã€‚\nç”±äºæˆ‘ä»¬éœ€è¦æ±‚çš„æ˜¯æ¯ä¸ªç”¨æˆ·çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªè®¢å•ï¼Œæ‰€ä»¥è¿™é‡Œè¦æŒ‡å®šçª—å£ï¼šä»ç¬¬ä¸€è¡Œ unbounded preceding åˆ°æœ€åä¸€è¡Œ unbounded followingã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  select order_id,user_no,amount,create_date, first_value(create_date) over w \u0026#39;first_transaction_time\u0026#39;, last_value(create_date) over w \u0026#39;last_transaction_time\u0026#39; from order_info window w as (partition by user_no order by create_date asc rows between unbounded preceding and unbounded following); +----------+---------+--------+---------------------+------------------------+-----------------------+ | order_id | user_no | amount | create_date | first_transaction_time | last_transaction_time | +----------+---------+--------+---------------------+------------------------+-----------------------+ | 1 | u0001 | 100 | 2018-01-01 00:00:00 | 2018-01-01 00:00:00 | 2018-01-20 00:00:00 | | 2 | u0001 | 300 | 2018-01-02 00:00:00 | 2018-01-01 00:00:00 | 2018-01-20 00:00:00 | | 3 | u0001 | 300 | 2018-01-02 00:00:00 | 2018-01-01 00:00:00 | 2018-01-20 00:00:00 | | 4 | u0001 | 800 | 2018-01-10 00:00:00 | 2018-01-01 00:00:00 | 2018-01-20 00:00:00 | | 5 | u0001 | 900 | 2018-01-20 00:00:00 | 2018-01-01 00:00:00 | 2018-01-20 00:00:00 | | 6 | u0002 | 500 | 2018-01-05 00:00:00 | 2018-01-05 00:00:00 | 2018-01-22 00:00:00 | | 7 | u0002 | 600 | 2018-01-06 00:00:00 | 2018-01-05 00:00:00 | 2018-01-22 00:00:00 | | 8 | u0002 | 300 | 2018-01-10 00:00:00 | 2018-01-05 00:00:00 | 2018-01-22 00:00:00 | | 9 | u0002 | 800 | 2018-01-16 00:00:00 | 2018-01-05 00:00:00 | 2018-01-22 00:00:00 | | 10 | u0002 | 800 | 2018-01-22 00:00:00 | 2018-01-05 00:00:00 | 2018-01-22 00:00:00 | +----------+---------+--------+---------------------+------------------------+-----------------------+   4. çª—å£å‡½æ•°çš„åº”ç”¨åœºæ™¯ ä¸‹é¢è¿™ç¯‡æ–‡ç« è½¬è½½è‡ª Jmx\u0026rsquo;s Blog ï¼ŒåŸæ–‡é“¾æ¥ï¼š ä½¿ç”¨Hive SQLçš„çª—å£å‡½æ•°è¿›è¡Œå•†åŠ¡æ•°æ®åˆ†æ ã€‚\nè¿™ç¯‡æ–‡ç« ä»ä¸€ä¸ªå•†åŠ¡åˆ†ææ¡ˆä¾‹å…¥æ‰‹ï¼Œè¯´æ˜ SQL çª—å£å‡½æ•°çš„ä½¿ç”¨æ–¹å¼ã€‚\né€šè¿‡æœ¬æ–‡çš„ 5 ä¸ªéœ€æ±‚åˆ†æï¼Œå¯ä»¥çœ‹å‡º SQL çª—å£å‡½æ•°çš„åŠŸèƒ½ååˆ†å¼ºå¤§ï¼Œä¸ä»…èƒ½å¤Ÿä½¿æˆ‘ä»¬ç¼–å†™çš„ SQL é€»è¾‘æ›´åŠ æ¸…æ™°ï¼Œè€Œä¸”åœ¨æŸç§ç¨‹åº¦ä¸Šå¯ä»¥ç®€åŒ–éœ€æ±‚å¼€å‘ã€‚\nè½¬è½½æ—¶ï¼Œåšäº†ä¸€äº›æ–‡å­—å’Œæ ¼å¼ä¸Šçš„ä¿®è®¢ã€‚\n ä½¿ç”¨ Hive SQL çš„çª—å£å‡½æ•°è¿›è¡Œå•†åŠ¡æ•°æ®åˆ†æ Jmx\u0026rsquo;s Blog  4.0 æ•°æ®å‡†å¤‡ æœ¬æ–‡ä¸»è¦åˆ†æåªæ¶‰åŠä¸€å¼ è®¢å•è¡¨ ordersï¼Œæ“ä½œè¿‡ç¨‹åœ¨ Hive ä¸­å®Œæˆï¼Œå…·ä½“æ•°æ®å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  -- å»ºè¡¨ CREATE TABLE orders( order_id int, customer_id string, city string, add_time string, amount decimal(10,2)); -- å‡†å¤‡æ•°æ® INSERT INTO orders VALUES (1,\u0026#34;A\u0026#34;,\u0026#34;ä¸Šæµ·\u0026#34;,\u0026#34;2020-01-01 00:00:00.000000\u0026#34;,200), (2,\u0026#34;B\u0026#34;,\u0026#34;ä¸Šæµ·\u0026#34;,\u0026#34;2020-01-05 00:00:00.000000\u0026#34;,250), (3,\u0026#34;C\u0026#34;,\u0026#34;åŒ—äº¬\u0026#34;,\u0026#34;2020-01-12 00:00:00.000000\u0026#34;,200), (4,\u0026#34;A\u0026#34;,\u0026#34;ä¸Šæµ·\u0026#34;,\u0026#34;2020-02-04 00:00:00.000000\u0026#34;,400), (5,\u0026#34;D\u0026#34;,\u0026#34;ä¸Šæµ·\u0026#34;,\u0026#34;2020-02-05 00:00:00.000000\u0026#34;,250), (5,\u0026#34;D\u0026#34;,\u0026#34;ä¸Šæµ·\u0026#34;,\u0026#34;2020-02-05 12:00:00.000000\u0026#34;,300), (6,\u0026#34;C\u0026#34;,\u0026#34;åŒ—äº¬\u0026#34;,\u0026#34;2020-02-19 00:00:00.000000\u0026#34;,300), (7,\u0026#34;A\u0026#34;,\u0026#34;ä¸Šæµ·\u0026#34;,\u0026#34;2020-03-01 00:00:00.000000\u0026#34;,150), (8,\u0026#34;E\u0026#34;,\u0026#34;åŒ—äº¬\u0026#34;,\u0026#34;2020-03-05 00:00:00.000000\u0026#34;,500), (9,\u0026#34;F\u0026#34;,\u0026#34;ä¸Šæµ·\u0026#34;,\u0026#34;2020-03-09 00:00:00.000000\u0026#34;,250), (10,\u0026#34;B\u0026#34;,\u0026#34;ä¸Šæµ·\u0026#34;,\u0026#34;2020-03-21 00:00:00.000000\u0026#34;,600);   4.1 éœ€æ±‚1ï¼šæ”¶å…¥å¢é•¿ åœ¨ä¸šåŠ¡æ–¹é¢ï¼Œç¬¬ m1 ä¸ªæœˆçš„æ”¶å…¥å¢é•¿è®¡ç®—å¦‚ä¸‹ï¼š100 *ï¼ˆm1-m0ï¼‰/ m0\nå…¶ä¸­ï¼Œm1 æ˜¯ç»™å®šæœˆä»½çš„æ”¶å…¥ï¼Œm0 æ˜¯ä¸Šä¸ªæœˆçš„æ”¶å…¥ã€‚å› æ­¤ï¼Œä»æŠ€æœ¯ä¸Šè®²ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°æ¯ä¸ªæœˆçš„æ”¶å…¥ï¼Œç„¶åä»¥æŸç§æ–¹å¼å°†æ¯ä¸ªæœˆçš„æ”¶å…¥ä¸ä¸Šä¸€ä¸ªæ”¶å…¥ç›¸å…³è”ï¼Œä»¥ä¾¿è¿›è¡Œä¸Šè¿°è®¡ç®—ã€‚è®¡ç®—å½“æ—¶å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  WITH monthly_revenue as ( SELECT trunc(add_time,\u0026#39;MM\u0026#39;) as month, sum(amount) as revenue FROM orders GROUP BY 1 ) ,prev_month_revenue as ( SELECT month, revenue, lag(revenue) over (order by month) as prev_month_revenue -- ä¸Šä¸€æœˆæ”¶å…¥  FROM monthly_revenue ) SELECT month, revenue, prev_month_revenue, round(100.0*(revenue-prev_month_revenue)/prev_month_revenue,1) as revenue_growth FROM prev_month_revenue ORDER BY 1   ç»“æœè¾“å‡ºï¼š\n   month revenue prev_month_revenue revenue_growth     2020-01-01 650 NULL NULL   2020-02-01 1250 650 92.3   2020-03-01 1500 1250 20    æˆ‘ä»¬è¿˜å¯ä»¥æŒ‰ç…§æŒ‰åŸå¸‚åˆ†ç»„è¿›è¡Œç»Ÿè®¡ï¼ŒæŸ¥çœ‹æŸä¸ªåŸå¸‚æŸä¸ªæœˆä»½çš„æ”¶å…¥å¢é•¿æƒ…å†µ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  WITH monthly_revenue as ( SELECT trunc(add_time,\u0026#39;MM\u0026#39;) as month, city, sum(amount) as revenue FROM orders GROUP BY 1,2 ) ,prev_month_revenue as ( SELECT month, city, revenue, lag(revenue) over (partition by city order by month) as prev_month_revenue FROM monthly_revenue ) SELECT month, city, revenue, round(100.0*(revenue-prev_month_revenue)/prev_month_revenue,1) as revenue_growth FROM prev_month_revenue ORDER BY 2,1   ç»“æœè¾“å‡ºï¼š\n   month city revenue revenue_growth     2020-01-01 ä¸Šæµ· 450 NULL   2020-02-01 ä¸Šæµ· 950 111.1   2020-03-01 ä¸Šæµ· 1000 5.3   2020-01-01 åŒ—äº¬ 200 NULL   2020-02-01 åŒ—äº¬ 300 50   2020-03-01 åŒ—äº¬ 500 66.7    4.2 éœ€æ±‚2ï¼šç´¯è®¡æ±‚å’Œ ç´¯è®¡æ±‡æ€»ï¼Œå³å½“å‰å…ƒç´ å’Œæ‰€æœ‰å…ˆå‰å…ƒç´ çš„æ€»å’Œï¼Œå¦‚ä¸‹é¢çš„ SQLï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  WITH monthly_revenue as ( SELECT trunc(add_time,\u0026#39;MM\u0026#39;) as month, sum(amount) as revenue FROM orders GROUP BY 1 ) SELECT month, revenue, sum(revenue) over (order by month rows between unbounded preceding and current row) as running_total FROM monthly_revenue ORDER BY 1   ç»“æœè¾“å‡ºï¼š\n   month revenue running_total     2020-01-01 650 650   2020-02-01 1250 1900   2020-03-01 1500 3400    æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ç»„åˆæ–¹å¼è¿›è¡Œåˆ†æï¼ŒSQL å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12  SELECT order_id, customer_id, city, add_time, amount, sum(amount) over () as amount_total, -- æ‰€æœ‰æ•°æ®æ±‚å’Œ  sum(amount) over (order by order_id rows between unbounded preceding and current row) as running_sum, -- ç´¯è®¡æ±‚å’Œ  sum(amount) over (partition by customer_id order by add_time rows between unbounded preceding and current row) as running_sum_by_customer, avg(amount) over (order by add_time rows between 5 preceding and current row) as trailing_avg -- æ»šåŠ¨æ±‚å¹³å‡ FROM orders ORDER BY 1   ç»“æœè¾“å‡ºï¼š\n   order_id customer_id city add_time amount amount_total running_sum running_sum_by_customer trailing_avg     1 A ä¸Šæµ· 2020-01-01 00:00:00.000000 200 3400 200 200 200   2 B ä¸Šæµ· 2020-01-05 00:00:00.000000 250 3400 450 250 225   3 C åŒ—äº¬ 2020-01-12 00:00:00.000000 200 3400 650 200 216.666667   4 A ä¸Šæµ· 2020-02-04 00:00:00.000000 400 3400 1050 600 262.5   5 D ä¸Šæµ· 2020-02-05 00:00:00.000000 250 3400 1300 250 260   5 D ä¸Šæµ· 2020-02-05 12:00:00.000000 300 3400 1600 550 266.666667   6 C åŒ—äº¬ 2020-02-19 00:00:00.000000 300 3400 1900 500 283.333333   7 A ä¸Šæµ· 2020-03-01 00:00:00.000000 150 3400 2050 750 266.666667   8 E åŒ—äº¬ 2020-03-05 00:00:00.000000 500 3400 2550 500 316.666667   9 F ä¸Šæµ· 2020-03-09 00:00:00.000000 250 3400 2800 250 291.666667   10 B ä¸Šæµ· 2020-03-21 00:00:00.000000 600 3400 3400 850     4.3 éœ€æ±‚3ï¼šå¤„ç†é‡å¤æ•°æ® ä»ä¸Šé¢çš„æ•°æ®å¯ä»¥çœ‹å‡ºï¼Œå­˜åœ¨ä¸¤æ¡é‡å¤çš„æ•°æ®**(5,â€Dâ€,â€ä¸Šæµ·â€,â€2020-02-05 00:00:00.000000â€,250), (5,â€Dâ€,â€ä¸Šæµ·â€,â€2020-02-05 12:00:00.000000â€,300),**æ˜¾ç„¶éœ€è¦å¯¹å…¶è¿›è¡Œæ¸…æ´—å»é‡ï¼Œä¿ç•™æœ€æ–°çš„ä¸€æ¡æ•°æ®ï¼ŒSQL å¦‚ä¸‹ï¼š\næˆ‘ä»¬å…ˆè¿›è¡Œåˆ†ç»„æ’åï¼Œç„¶åä¿ç•™æœ€æ–°çš„é‚£æ¡æ•°æ®å³å¯ï¼š\n1 2 3 4 5 6 7  SELECT * FROM ( SELECT *, row_number() over (partition by order_id order by add_time desc) as rank FROM orders ) t WHERE rank=1   ç»“æœè¾“å‡ºï¼š\n   t.order_id t.customer_id t.city t.add_time t.amount t.rank     1 A ä¸Šæµ· 2020-01-01 00:00:00.000000 200 1   2 B ä¸Šæµ· 2020-01-05 00:00:00.000000 250 1   3 C åŒ—äº¬ 2020-01-12 00:00:00.000000 200 1   4 A ä¸Šæµ· 2020-02-04 00:00:00.000000 400 1   5 D ä¸Šæµ· 2020-02-05 12:00:00.000000 300 1   6 C åŒ—äº¬ 2020-02-19 00:00:00.000000 300 1   7 A ä¸Šæµ· 2020-03-01 00:00:00.000000 150 1   8 E åŒ—äº¬ 2020-03-05 00:00:00.000000 500 1   9 F ä¸Šæµ· 2020-03-09 00:00:00.000000 250 1   10 B ä¸Šæµ· 2020-03-21 00:00:00.000000 600 1    ç»è¿‡ä¸Šé¢çš„æ¸…æ´—è¿‡ç¨‹ï¼Œå¯¹æ•°æ®è¿›è¡Œäº†å»é‡ã€‚é‡æ–°è®¡ç®—ä¸Šé¢çš„éœ€æ±‚1ï¼Œæ­£ç¡® SQL è„šæœ¬ä¸ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  WITH orders_cleaned as ( SELECT * FROM ( SELECT *, row_number() over (partition by order_id order by add_time desc) as rank FROM orders )t WHERE rank=1 ) ,monthly_revenue as ( SELECT trunc(add_time,\u0026#39;MM\u0026#39;) as month, sum(amount) as revenue FROM orders_cleaned GROUP BY 1 ) ,prev_month_revenue as ( SELECT month, revenue, lag(revenue) over (order by month) as prev_month_revenue FROM monthly_revenue ) SELECT month, revenue, round(100.0*(revenue-prev_month_revenue)/prev_month_revenue,1) as revenue_growth FROM prev_month_revenue ORDER BY 1   ç»“æœè¾“å‡ºï¼š\n   month revenue revenue_growth     2020-01-01 650 NULL   2020-02-01 1000 53.8   2020-03-01 1500 50    å°†æ¸…æ´—åçš„æ•°æ®åˆ›å»ºæˆè§†å›¾ï¼Œæ–¹ä¾¿ä»¥åä½¿ç”¨\n1 2 3 4 5 6 7 8 9 10 11 12 13  CREATE VIEW orders_cleaned AS SELECT order_id, customer_id, city, add_time, amount FROM ( SELECT *, row_number() over (partition by order_id order by add_time desc) as rank FROM orders )t WHERE rank=1   4.4 éœ€æ±‚4ï¼šåˆ†ç»„å–TopN åˆ†ç»„å– TopN æ˜¯æœ€é•¿è§çš„ SQL çª—å£å‡½æ•°ä½¿ç”¨åœºæ™¯ï¼Œä¸‹é¢çš„ SQL æ˜¯è®¡ç®—æ¯ä¸ªæœˆä»½çš„ top2 è®¢å•é‡‘é¢ï¼Œå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  WITH orders_ranked as ( SELECT trunc(add_time,\u0026#39;MM\u0026#39;) as month, *, row_number() over (partition by trunc(add_time,\u0026#39;MM\u0026#39;) order by amount desc, add_time) as rank FROM orders_cleaned ) SELECT month, order_id, customer_id, city, add_time, amount FROM orders_ranked WHERE rank \u0026lt;=2 ORDER BY 1   4.5 éœ€æ±‚5ï¼šé‡å¤è´­ä¹°è¡Œä¸º ä¸‹é¢çš„ SQL è®¡ç®—é‡å¤è´­ä¹°ç‡ï¼šé‡å¤è´­ä¹°çš„äººæ•°/æ€»äººæ•°*100%ä»¥åŠç¬¬ä¸€ç¬”è®¢å•é‡‘é¢ä¸ç¬¬äºŒç¬”è®¢å•é‡‘é¢ä¹‹é—´çš„å…¸å‹å·®é¢:avg(ç¬¬äºŒç¬”è®¢å•é‡‘é¢/ç¬¬ä¸€ç¬”è®¢å•é‡‘é¢)\n1 2 3 4 5 6 7 8 9 10  WITH customer_orders as ( SELECT *, row_number() over (partition by customer_id order by add_time) as customer_order_n, lag(amount) over (partition by customer_id order by add_time) as prev_order_amount FROM orders_cleaned ) SELECT round(100.0*sum(case when customer_order_n=2 then 1 end)/count(distinct customer_id),1) as repeat_purchases,-- é‡å¤è´­ä¹°ç‡ avg(case when customer_order_n=2 then 1.0*amount/prev_order_amount end) as revenue_expansion -- é‡å¤è´­ä¹°è¾ƒä¸Šæ¬¡è´­ä¹°å·®å¼‚ï¼Œç¬¬ä¸€ç¬”è®¢å•é‡‘é¢ä¸ç¬¬äºŒç¬”è®¢å•é‡‘é¢ä¹‹é—´çš„å…¸å‹å·®é¢ FROM customer_orders   ç»“æœè¾“å‡ºï¼š\n   orders_cleaned.order_id orders_cleaned.customer_id orders_cleaned.city orders_cleaned.add_time orders_cleaned.amount customer_order_n prev_order_amount     1 A ä¸Šæµ· 2020-01-01 00:00:00.000000 200 1 NULL   4 A ä¸Šæµ· 2020-02-04 00:00:00.000000 400 2 200   7 A ä¸Šæµ· 2020-03-01 00:00:00.000000 150 3 400   2 B ä¸Šæµ· 2020-01-05 00:00:00.000000 250 1 NULL   10 B ä¸Šæµ· 2020-03-21 00:00:00.000000 600 2 250   3 C åŒ—äº¬ 2020-01-12 00:00:00.000000 200 1 NULL   6 C åŒ—äº¬ 2020-02-19 00:00:00.000000 300 2 200   5 D ä¸Šæµ· 2020-02-05 12:00:00.000000 300 1 NULL   8 E åŒ—äº¬ 2020-03-05 00:00:00.000000 500 1 NULL   9 F ä¸Šæµ· 2020-03-09 00:00:00.000000 250      æœ€ç»ˆç»“æœè¾“å‡ºï¼š\n   repeat_purchases revenue_expansion     50 1.9666666666666668    5. å‚è€ƒ  SQL åŸºç¡€æ•™ç¨‹ï¼ˆç¬¬ 2 ç‰ˆï¼‰- MICK (ä½œè€…) å­™æ·¼ , ç½—å‹‡ (è¯‘è€…) MySQL çª—å£å‡½æ•° https://tding.top/archives/c6e31643.html ä½¿ç”¨ Hive SQL çš„çª—å£å‡½æ•°è¿›è¡Œå•†åŠ¡æ•°æ®åˆ†æ Jmx\u0026rsquo;s Blog  ","permalink":"https://xy19950225.github.io/2020-11-13-sql-%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0%E6%80%BB%E7%BB%93/","tags":["SQL","çª—å£å‡½æ•°"],"title":"SQL çª—å£å‡½æ•°æ€»ç»“"},{"categories":["æ–‡æ¡£"],"contents":"äº†è§£å¦‚ä½•åœ¨ LoveIt ä¸»é¢˜ä¸­å¿«é€Ÿ, ç›´è§‚åœ°åˆ›å»ºå’Œç»„ç»‡å†…å®¹.\n1 å†…å®¹ç»„ç»‡ ä»¥ä¸‹æ˜¯ä¸€äº›æ–¹ä¾¿ä½ æ¸…æ™°ç®¡ç†å’Œç”Ÿæˆæ–‡ç« çš„ç›®å½•ç»“æ„å»ºè®®:\n ä¿æŒåšå®¢æ–‡ç« å­˜æ”¾åœ¨ content/posts ç›®å½•, ä¾‹å¦‚: content/posts/æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« .md ä¿æŒç®€å•çš„é™æ€é¡µé¢å­˜æ”¾åœ¨ content ç›®å½•, ä¾‹å¦‚: content/about.md ä¿æŒå›¾ç‰‡ä¹‹ç±»çš„åª’ä½“èµ„æºå­˜æ”¾åœ¨ static ç›®å½•, ä¾‹å¦‚: static/images/screenshot.png  2 å‰ç½®å‚æ•° Hugo å…è®¸ä½ åœ¨æ–‡ç« å†…å®¹å‰é¢æ·»åŠ  yaml, toml æˆ–è€… json æ ¼å¼çš„å‰ç½®å‚æ•°.\næ³¨æ„\nä¸æ˜¯æ‰€æœ‰çš„ä»¥ä¸‹å‰ç½®å‚æ•°éƒ½å¿…é¡»åœ¨ä½ çš„æ¯ç¯‡æ–‡ç« ä¸­è®¾ç½®. åªæœ‰åœ¨æ–‡ç« çš„å‚æ•°å’Œä½ çš„ ç½‘ç«™è®¾ç½® ä¸­çš„ page éƒ¨åˆ†ä¸ä¸€è‡´æ—¶æ‰æœ‰å¿…è¦è¿™ä¹ˆåš.\n","permalink":"https://xy19950225.github.io/2020-11-13-%E4%B8%BB%E9%A2%98%E6%96%87%E6%A1%A3-%E5%86%85%E5%AE%B9/","tags":["é…ç½®","Markdown"],"title":"ä¸»é¢˜æ–‡æ¡£ - å†…å®¹"},{"categories":[],"contents":"2020-11-17 2020-11-17 2020-11-17 å¯¼èˆªæ æ·»åŠ Font Awesome å›¾æ ‡\n2020-11-15 æ·»åŠ æœç´¢åŠŸèƒ½\n2020-11-13 å°†Even ä¸»é¢˜æ›´æ¢ä¸º LoveIt ä¸»é¢˜\n2020-10-01 å°†åšå®¢è¿ç§»åˆ° Hugo ï¼Œé‡‡ç”¨ Even ä¸»é¢˜ï¼Œå¹¶éƒ¨ç½²åˆ° GitHub Pages ä¸Š\n2020-07-13 ä½¿ç”¨ Material for MkDocs æ­å»ºä¸ªäººåšå®¢\n","permalink":"https://xy19950225.github.io/about/","tags":[],"title":"å…³äº"},{"categories":[],"contents":"Bç«™  ","permalink":"https://xy19950225.github.io/movie/","tags":[],"title":"ç”µå½±"},{"categories":[],"contents":"ç½‘æ˜“äº‘  ","permalink":"https://xy19950225.github.io/music/","tags":[],"title":"éŸ³ä¹"},{"categories":null,"contents":"","permalink":"https://xy19950225.github.io/search/","tags":null,"title":"Search"}]