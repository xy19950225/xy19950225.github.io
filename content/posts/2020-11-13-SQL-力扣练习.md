---
title: "SQL åŠ›æ‰£ç»ƒä¹ "
date: 2020-11-13T16:30:05+08:00
lastmod: 2020-11-13T16:30:05+08:00
draft: false

tags: ["LeeCode",  "SQL"]
categories: ["åˆ·é¢˜"]
hiddenFromHomePage: false

featuredImage: ""
featuredImagePreview: ""

toc: true
autoCollapseToc: true
math: true
lightgallery: true
linkToMarkdown: true
---

è¿™ç¯‡æ–‡ç« ä¸»è¦æ•´ç†éƒ¨åˆ† LeeCode æ•°æ®åº“ç»ƒä¹ é¢˜ã€‚

<!--more-->

## 1 å‰è¨€

æœ¬æ–‡ä¸»è¦æ•´ç† LeeCode æ•°æ®åº“ç»ƒä¹ ï¼Œå†…å®¹é€šå¸¸åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼šé¢˜ç›®ç®€è¿°ã€é‡è¦çŸ¥è¯†ç‚¹ã€è§£é¢˜æ€è·¯ã€é€»è¾‘æ­¥éª¤å’Œæ­£ç¡®çš„ SQL ä»£ç ã€‚

**æœ€åå‘åœ¨è¯„è®ºåŒºåˆ†äº«ç»éªŒçš„å¹¿å¤§ç½‘å‹è‡´è°¢ï¼**



## 2 æ­£æ–‡



### 2.1 ç®€å•

#### [176. ç¬¬äºŒé«˜çš„è–ªæ°´](https://leetcode-cn.com/problems/second-highest-salary/)

é¢˜ç›®æè¿°ï¼š

ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œè·å– Employee è¡¨ä¸­ç¬¬äºŒé«˜çš„è–ªæ°´ï¼ˆSalaryï¼‰

|   Id | Salary |
| :---:  | :-----:  |
|    1 |    100 |
|    2 |    200 |
|    3 |    300 |

ä¾‹å¦‚ä¸Šè¿° Employee è¡¨ï¼ŒSQL æŸ¥è¯¢åº”è¯¥è¿”å› 200 ä½œä¸ºç¬¬äºŒé«˜çš„è–ªæ°´ã€‚ å¦‚æœä¸å­˜åœ¨ç¬¬äºŒé«˜çš„è–ªæ°´ï¼Œé‚£ä¹ˆæŸ¥è¯¢åº”è¿”å› NULL

| SecondHighestSalary |
| :-----------------: |
|         200         |

è§£é¢˜æ–¹æ³•ï¼š

```sql
# æ–¹æ³•ä¸€ï¼šä½¿ç”¨å­æŸ¥è¯¢å’Œ LIMIT å­å¥    
# æ­¤æ–¹æ³•å¯é€‚ç”¨äºæ±‚ç¬¬ N é«˜çš„è–ªæ°´ï¼Œä¸”æ•°æ®è¶Šå¤æ‚ï¼Œé€Ÿåº¦ä¼˜åŠ¿è¶Šæ˜æ˜¾
SELECT
    (SELECT DISTINCT salary 
    FROM employee
    ORDER BY salary DESC
    LIMIT 1,1) AS SecondHighestSalary;
    
# æ–¹æ³•äºŒï¼šä½¿ç”¨ IFNULL å’Œ LIMIT å­å¥
SELECT
   IFNULL(
    (SELECT DISTINCT salary
    FROM employee
    ORDER BY salary DESC
    LIMIT 1,1),NULL)  AS SecondHighestSalary;
    
# æ–¹æ³•ä¸‰ï¼šä½¿ç”¨å­æŸ¥è¯¢å’Œ MAX() å‡½æ•°
SELECT MAX(salary) AS SecondHighestSalary
FROM employee
WHERE salary < 
    (SELECT MAX(salary)
    FROM employee);
```



#### [596. è¶…è¿‡5åå­¦ç”Ÿçš„è¯¾](https://leetcode-cn.com/problems/classes-more-than-5-students/)

é¢˜ç›®æè¿°ï¼š

æœ‰ä¸€ä¸ª courses è¡¨ ï¼Œæœ‰ student (å­¦ç”Ÿ) å’Œ class (è¯¾ç¨‹)ï¼Œè¯·åˆ—å‡ºæ‰€æœ‰è¶…è¿‡æˆ–ç­‰äº 5 åå­¦ç”Ÿçš„è¯¾ã€‚ä¾‹å¦‚ï¼Œcourses è¡¨ï¼š


| student | class    |
| :-------: | :--------: |
| A       | Math     |
| B       | English  |
| C       | Math     |
| D       | Biology  |
| E       | Math     |
| F       | Computer |
| G       | Math     |
| H       | Math     |
| I       | Math     |

åº”è¯¥è¾“å‡º:

| class |
| :-----: |
| Math  |

æç¤ºï¼šå­¦ç”Ÿåœ¨æ¯ä¸ªè¯¾ä¸­ä¸åº”è¢«é‡å¤è®¡ç®—

è§£é¢˜æ–¹æ³•ï¼š

```sql
# æ–¹æ³•ï¼šä½¿ç”¨ GROUP BY å’Œ HAVING
SELECT class
FROM courses
GROUP BY class
HAVING COUNT(DISTINCT student) >=5;
```



#### [197. ä¸Šå‡çš„æ¸©åº¦](https://leetcode-cn.com/problems/rising-temperature/)

é¢˜ç›®æè¿°ï¼š

ç»™å®šä¸€ä¸ª Weather è¡¨ï¼Œç¼–å†™ä¸€ä¸ª SQL  æŸ¥è¯¢ï¼Œæ¥æŸ¥æ‰¾ä¸ä¹‹å‰ï¼ˆæ˜¨å¤©çš„ï¼‰æ—¥æœŸç›¸æ¯”æ¸©åº¦æ›´é«˜çš„æ‰€æœ‰æ—¥æœŸçš„ Id

| Id(INT) | RecordDate(DATE) | Temperature(INT) |
| :------: | :---------------: | :---------------: |
|       1 |       2015-01-01 |               10 |
|       2 |       2015-01-02 |               25 |
|       3 |       2015-01-03 |               20 |
|       4 |       2015-01-04 |               30 |



ä¾‹å¦‚ï¼Œæ ¹æ®ä¸Šè¿°ç»™å®šçš„ Weather è¡¨æ ¼ï¼Œè¿”å›å¦‚ä¸‹ Id:

|   Id |
| :---: |
|    2 |
|    4 |



è§£é¢˜æ–¹æ³•ï¼š

```sql
# æ–¹æ³•ä¸€ï¼šä½¿ç”¨ JOIN å’Œ DATEDIFF() å‡½æ•°
SELECT a.id AS id
FROM weather a
JOIN weather b
ON DATEDIFF(a.recorddate,b.recorddate)=1
AND a.temperature > b.temperature;

# æ–¹æ³•äºŒï¼šä½¿ç”¨ WHERE å’Œ DATEDIFF() å‡½æ•°
SELECT a.id
FROM weather a, weather b 
WHERE DATEDIFF(a.recorddate,b.recorddate)=1 
    AND a.temperature > b.temperature;
```



### 2.2 ä¸­ç­‰

#### [177. ç¬¬Né«˜çš„è–ªæ°´](https://leetcode-cn.com/problems/nth-highest-salary/)

é¢˜ç›®æè¿°ï¼š

ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œè·å– Employee è¡¨ä¸­ç¬¬ n é«˜çš„è–ªæ°´ï¼ˆSalaryï¼‰

|   Id | Salary |
| :---: | :-----: |
|    1 |    100 |
|    2 |    200 |
|    3 |    300 |



ä¾‹å¦‚ä¸Šè¿° Employee è¡¨ï¼Œn = 2 æ—¶ï¼Œåº”è¿”å›ç¬¬äºŒé«˜çš„è–ªæ°´ 200ï¼›å¦‚æœä¸å­˜åœ¨ç¬¬ n é«˜çš„è–ªæ°´ï¼Œé‚£ä¹ˆæŸ¥è¯¢åº”è¿”å› NULL



| getNthHighestSalary(2) |
| :--------------------: |
|          200           |

è§£é¢˜æ–¹æ³•ï¼š

```sql
CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT
BEGIN
    SET N = N-1;
  RETURN (
      # Write your MySQL query statement below.
      SELECT DISTINCT salary 
      FROM employee
      ORDER BY salary DESC
      LIMIT N,1
  );
END
```



#### [184. éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥](https://leetcode-cn.com/problems/department-highest-salary/)

é¢˜ç›®æè¿°ï¼š

Employee è¡¨åŒ…å«æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ï¼Œæ¯ä¸ªå‘˜å·¥æœ‰å…¶å¯¹åº”çš„ Id, Salary å’Œ  DepartmentId

|   Id | Name  | Salary | DepartmentId |
| :---: | :-----: | :-----: | :-----------: |
|    1 | Joe   |  70000 |            1 |
|    2 | Jim   |  90000 |            1 |
|    3 | Henry |  80000 |            2 |
|    4 | Sam   |  60000 |            2 |
|    5 | Max   |  90000 |            1 |

Department è¡¨åŒ…å«å…¬å¸æ‰€æœ‰éƒ¨é—¨çš„ä¿¡æ¯

|   Id | Name  |
| :---: | :-----: |
|    1 | IT    |
|    2 | Sales |

ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ‰¾å‡ºæ¯ä¸ªéƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥ã€‚å¯¹äºä¸Šè¿°è¡¨ï¼Œæ‚¨çš„ SQL æŸ¥è¯¢åº”è¿”å›ä»¥ä¸‹è¡Œï¼ˆè¡Œçš„é¡ºåºæ— å…³ç´§è¦ï¼‰

| Department | Employee | Salary |
| :----------: | :--------: | :-----: |
| IT         | Max      |  90000 |
| IT         | Jim      |  90000 |
| Sales      | Henry    |  80000 |

è§£é‡Šï¼šMax å’Œ Jim åœ¨ IT éƒ¨é—¨çš„å·¥èµ„éƒ½æ˜¯æœ€é«˜çš„ï¼ŒHenry åœ¨é”€å”®éƒ¨çš„å·¥èµ„æœ€é«˜

è§£é¢˜æ–¹æ³•ï¼š

```sql
# é”™è¯¯å†™æ³•
SELECT 
    d.name AS Department,
    e.name AS Employee,
    MAX(e.salary) AS Salary
FROM employee e 
JOIN department d 
ON e.departmentid=d.id
GROUP BY Department,Employee,Salary;

# æ­£ç¡®å†™æ³•
# æ–¹æ³•ï¼šä½¿ç”¨ JOIN å’Œ IN è¯­å¥
SELECT
    d.name AS Department,
    e.name AS Employee,
    e.salary AS Salary
FROM employee e
JOIN department d ON e.departmentid = d.id
WHERE (e.departmentid , e.salary) IN
    (SELECT departmentid, MAX(salary)
    FROM employee
    GROUP BY departmentid
	)
;
```



#### [180. è¿ç»­å‡ºç°çš„æ•°å­—](https://leetcode-cn.com/problems/consecutive-numbers/)

é¢˜ç›®æè¿°ï¼š

ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼ŒæŸ¥æ‰¾æ‰€æœ‰è‡³å°‘è¿ç»­å‡ºç°ä¸‰æ¬¡çš„æ•°å­—

|   Id |  Num |
| :--: | :--: |
|    1 |    1 |
|    2 |    1 |
|    3 |    1 |
|    4 |    2 |
|    5 |    1 |
|    6 |    2 |
|    7 |    2 |

ä¾‹å¦‚ï¼Œç»™å®šä¸Šé¢çš„ Logs è¡¨ï¼Œ 1 æ˜¯å”¯ä¸€è¿ç»­å‡ºç°è‡³å°‘ä¸‰æ¬¡çš„æ•°å­—

| ConsecutiveNums |
| :-------------: |
|        1        |

è§£é¢˜æ–¹æ³•ï¼š

```sql
# æ–¹æ³•ä¸€ï¼šç”¨ DISTINCT å’Œ WHERE è¯­å¥ 
SELECT DISTINCT a.num AS ConsecutiveNums
FROM Logs a ,Logs b , Logs c 
WHERE b.id = a.id + 1 AND c.id = b.id + 1
AND b.num = a.num AND c.num = b.num;

# æ–¹æ³•äºŒ: ç”¨ DISTINCT å’Œ JOIN è¯­å¥
# æ¯”æ–¹æ³•ä¸€æ‰§è¡Œé€Ÿåº¦æ›´å¿«
SELECT DISTINCT a.num AS ConsecutiveNums
FROM logs a
LEFT JOIN logs b 
ON b.id = a.id + 1
LEFT JOIN logs c 
ON c.id = b.id + 1
WHERE b.num = a.num AND c.num = b.num;

# ä¸Šè¿°ä¸¤ç§æ–¹æ³•æœ‰ç‚¹æŠ•æœºå–å·§ï¼Œå¦‚æœ ID ä¸è¿ç»­ï¼Œè¿ç»­å‡ºç° N æ¬¡ï¼Ÿ
# æ–¹æ³•ä¸‰ï¼š ç”¨çª—å£å‡½æ•° ROW_NUMBER() OVER
# å‚è€ƒå¤§ä½¬çš„æ€è·¯
SELECT DISTINCT num AS ConsecutiveNums
FROM 
(SELECT num,COUNT(*) AS num_count
FROM 
(SELECT 
    id, 
    num,
    ROW_NUMBER() OVER(ORDER BY id) - ROW_NUMBER() OVER(PARTITION BY num ORDER BY id) AS orde
FROM logs ) AS  w 
GROUP BY num,orde) AS s 
WHERE num_count >=3;
```



#### [178. åˆ†æ•°æ’å](https://leetcode-cn.com/problems/rank-scores/)

é¢˜ç›®æè¿°ï¼š

ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢æ¥å®ç°åˆ†æ•°æ’åï¼Œå¦‚æœä¸¤ä¸ªåˆ†æ•°ç›¸åŒï¼Œåˆ™ä¸¤ä¸ªåˆ†æ•°æ’åï¼ˆRankï¼‰ç›¸åŒ

è¯·æ³¨æ„ï¼Œå¹³åˆ†åçš„ä¸‹ä¸€ä¸ªåæ¬¡åº”è¯¥æ˜¯ä¸‹ä¸€ä¸ªè¿ç»­çš„æ•´æ•°å€¼ï¼›æ¢å¥è¯è¯´ï¼Œåæ¬¡ä¹‹é—´ä¸åº”è¯¥æœ‰â€œé—´éš”â€

|   Id | Score |
| :--: | :---: |
|    1 |  3.50 |
|    2 |  3.65 |
|    3 |  4.00 |
|    4 |  3.85 |
|    5 |  4.00 |
|    6 |  3.65 |

ä¾‹å¦‚ï¼Œæ ¹æ®ä¸Šè¿°ç»™å®šçš„ Scores è¡¨ï¼Œä½ çš„æŸ¥è¯¢åº”è¯¥è¿”å›ï¼ˆæŒ‰åˆ†æ•°ä»é«˜åˆ°ä½æ’åˆ—ï¼‰ï¼š

| Score | Rank |
| :---: | :--: |
|  4.00 |    1 |
|  4.00 |    1 |
|  3.85 |    2 |
|  3.65 |    3 |
|  3.65 |    3 |
|  3.50 |    4 |

é‡è¦æç¤ºï¼šå¯¹äº MySQL è§£å†³æ–¹æ¡ˆï¼Œå¦‚æœè¦è½¬ä¹‰ç”¨ä½œåˆ—åçš„ä¿ç•™å­—ï¼Œå¯ä»¥åœ¨å…³é”®å­—ä¹‹å‰å’Œä¹‹åä½¿ç”¨æ’‡å·ã€‚ä¾‹å¦‚ `Rank`

è§£é¢˜æ–¹æ³•ï¼š

```sql
# ç”¨çª—å£å‡½æ•° DENSE_RANK() OVER()
SELECT 
    score,
    DENSE_RANK() OVER(ORDER BY score DESC) 'Rank'
FROM scores; 
```



### 2.3 å›°éš¾

#### [185. éƒ¨é—¨å·¥èµ„å‰ä¸‰é«˜çš„æ‰€æœ‰å‘˜å·¥](https://leetcode-cn.com/problems/department-top-three-salaries/)

é¢˜ç›®æè¿°ï¼š

Employee è¡¨åŒ…å«æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ï¼Œæ¯ä¸ªå‘˜å·¥æœ‰å…¶å¯¹åº”çš„å·¥å· Idï¼Œå§“å Nameï¼Œå·¥èµ„ Salary å’Œéƒ¨é—¨ç¼–å· DepartmentId 

|   Id | Name  | Salary | DepartmentId |
| :--: | :---: | :----: | :----------: |
|    1 | Joe   |  85000 |            1 |
|    2 | Henry |  80000 |            2 |
|    3 | Sam   |  60000 |            2 |
|    4 | Max   |  90000 |            1 |
|    5 | Janet |  69000 |            1 |
|    6 | Randy |  85000 |            1 |
|    7 | Will  |  70000 |            1 |

Department è¡¨åŒ…å«å…¬å¸æ‰€æœ‰éƒ¨é—¨çš„ä¿¡æ¯ï¼š

|   Id | Name  |
| :--: | :---: |
|    1 | IT    |
|    2 | Sales |

ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ‰¾å‡ºæ¯ä¸ªéƒ¨é—¨è·å¾—å‰ä¸‰é«˜å·¥èµ„çš„æ‰€æœ‰å‘˜å·¥ã€‚ä¾‹å¦‚ï¼Œæ ¹æ®ä¸Šè¿°ç»™å®šçš„è¡¨ï¼ŒæŸ¥è¯¢ç»“æœåº”è¿”å›ï¼š

| Department | Employee | Salary |
| :--------: | :------: | :----: |
| IT         | Max      |  90000 |
| IT         | Randy    |  85000 |
| IT         | Joe      |  85000 |
| IT         | Will     |  70000 |
| Sales      | Henry    |  80000 |
| Sales      | Sam      |  60000 |

è§£é‡Šï¼šIT éƒ¨é—¨ä¸­ï¼ŒMax è·å¾—äº†æœ€é«˜çš„å·¥èµ„ï¼ŒRandy å’Œ Joe éƒ½æ‹¿åˆ°äº†ç¬¬äºŒé«˜çš„å·¥èµ„ï¼ŒWill çš„å·¥èµ„æ’ç¬¬ä¸‰ã€‚é”€å”®éƒ¨é—¨ï¼ˆSalesï¼‰åªæœ‰ä¸¤åå‘˜å·¥ï¼ŒHenry çš„å·¥èµ„æœ€é«˜ï¼ŒSam çš„å·¥èµ„æ’ç¬¬äºŒ

è§£é¢˜æ–¹æ³•ï¼š

```sql
SELECT department,employee,salary
FROM 
(SELECT 
    d.name AS department,
    e.name AS employee,
    e.salary AS salary,
    e.departmentid,
    DENSE_RANK() OVER(PARTITION BY departmentid ORDER BY salary DESC) AS rk
FROM employee e 
JOIN department d 
ON e.departmentid=d.id) AS w 
WHERE rk <= 3;
```



#### [601. ä½“è‚²é¦†çš„äººæµé‡](https://leetcode-cn.com/problems/human-traffic-of-stadium/)

é¢˜ç›®æè¿°ï¼š

X å¸‚å»ºäº†ä¸€ä¸ªæ–°çš„ä½“è‚²é¦†ï¼Œæ¯æ—¥äººæµé‡ä¿¡æ¯è¢«è®°å½•åœ¨è¿™ä¸‰åˆ—ä¿¡æ¯ä¸­ï¼šåºå· (id)ã€æ—¥æœŸ (visit_date)ã€ äººæµé‡ (people)ã€‚

è¯·ç¼–å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œæ‰¾å‡ºäººæµé‡çš„é«˜å³°æœŸã€‚é«˜å³°æœŸæ—¶ï¼Œè‡³å°‘è¿ç»­ä¸‰è¡Œè®°å½•ä¸­çš„äººæµé‡ä¸å°‘äº100ã€‚

ä¾‹å¦‚ï¼Œè¡¨ stadiumï¼š

|   id | visit_date | people |
| :--: | :--------: | :----: |
|    1 | 2017-01-01 |     10 |
|    2 | 2017-01-02 |    109 |
|    3 | 2017-01-03 |    150 |
|    4 | 2017-01-04 |     99 |
|    5 | 2017-01-05 |    145 |
|    6 | 2017-01-06 |   1455 |
|    7 | 2017-01-07 |    199 |
|    8 | 2017-01-08 |    188 |

å¯¹äºä¸Šé¢çš„ç¤ºä¾‹æ•°æ®ï¼Œè¾“å‡ºä¸ºï¼š

|   id | visit_date | people |
| :--: | :--------: | :----: |
|    5 | 2017-01-05 |    145 |
|    6 | 2017-01-06 |   1455 |
|    7 | 2017-01-07 |    199 |
|    8 | 2017-01-08 |    188 |

**æç¤ºï¼š**

- æ¯å¤©åªæœ‰ä¸€è¡Œè®°å½•ï¼Œæ—¥æœŸéšç€ id çš„å¢åŠ è€Œå¢åŠ ã€‚
- ä½“è‚²é¦†å¹¶ä¸æ˜¯æ¯å¤©éƒ½å¼€æ”¾çš„ï¼Œæ‰€ä»¥è®°å½•ä¸­çš„æ—¥æœŸå¯èƒ½ä¼šå‡ºç°æ–­å±‚ã€‚

è§£é¢˜æ–¹æ³•ï¼š

```sql
# æ–¹æ³•ä¸€ï¼šä½¿ç”¨åŒå±‚çª—å£å‡½æ•°ï¼Œå†…å±‚çª—å£å‡½æ•°æ±‚åˆ†ç»„ç¼–å·ï¼Œå¤–å±‚å¯¹åˆ†ç»„ç»“æœè®°å½•æ•°æ±‚å’Œ
SELECT 
    id,
    visit_date,
    people
FROM 
(SELECT 
    id,
    visit_date,
    people,
    COUNT(*) OVER(PARTITION BY a) AS b -- 3.è·å¾—åŒä¸€è¿ç»­ç»„å†…è®°å½•æ•°
FROM
(SELECT 
    id,
    visit_date,
    people,
    id-ROW_NUMBER() OVER(ORDER BY visit_date) AS a -- 2.æŒ‰æ—¥æœŸæ’åº ç”¨id-row_numberçš„æ–¹å¼åˆ¤æ–­æ˜¯å¦è¿ç»­
FROM stadium
WHERE people >=100) AS w) AS q -- 1.æŒ‘é€‰å‡ºäººæµè¶…è¿‡100çš„å¤©æ•°
WHERE b >=3;

# æ–¹æ³•äºŒ
SELECT 
    id,
    visit_date,
    people
FROM
(SELECT 
    id,
    visit_date,
    people,
    LAG(people,2) OVER(ORDER BY id) AS pprvpeople,
    LAG(people,1) OVER(ORDER BY id) AS prvpeople,
    LEAD(people,1) OVER(ORDER BY id) AS nextpeople,
    LEAD(people,2) OVER(ORDER BY id) AS nnextpeople
FROM stadium) AS people
WHERE
 (people >=100 AND pprvpeople >=100 AND prvpeople >=100) OR
 (people >=100 AND prvpeople >=100 AND nextpeople >=100) OR
 (people >=100 AND nextpeople >=100 AND nnextpeople >=100);
```



#### [262. è¡Œç¨‹å’Œç”¨æˆ·](https://leetcode-cn.com/problems/trips-and-users/)

é¢˜ç›®æè¿°ï¼š

Trips è¡¨ä¸­å­˜æ‰€æœ‰å‡ºç§Ÿè½¦çš„è¡Œç¨‹ä¿¡æ¯ã€‚æ¯æ®µè¡Œç¨‹æœ‰å”¯ä¸€é”® Idï¼ŒClient_Id å’Œ Driver_Id æ˜¯ Users è¡¨ä¸­ Users_Id çš„å¤–é”®ã€‚Status æ˜¯æšä¸¾ç±»å‹ï¼Œæšä¸¾æˆå‘˜ä¸º (â€˜completedâ€™, â€˜cancelled_by_driverâ€™, â€˜cancelled_by_clientâ€™)ã€‚

|   Id | Client_Id | Driver_Id | City_Id | Status              | Request_at |
| :--: | :-------: | :-------: | :-----: | :-----------------: | :--------: |
|    1 |         1 |        10 |       1 | completed           | 2013-10-01 |
|    2 |         2 |        11 |       1 | cancelled_by_driver | 2013-10-01 |
|    3 |         3 |        12 |       6 | completed           | 2013-10-01 |
|    4 |         4 |        13 |       6 | cancelled_by_client | 2013-10-01 |
|    5 |         1 |        10 |       1 | completed           | 2013-10-02 |
|    6 |         2 |        11 |       6 | completed           | 2013-10-02 |
|    7 |         3 |        12 |       6 | completed           | 2013-10-02 |
|    8 |         2 |        12 |      12 | completed           | 2013-10-03 |
|    9 |         3 |        10 |      12 | completed           | 2013-10-03 |
|   10 |         4 |        13 |      12 | cancelled_by_driver | 2013-10-03 |

Users è¡¨å­˜æ‰€æœ‰ç”¨æˆ·ã€‚æ¯ä¸ªç”¨æˆ·æœ‰å”¯ä¸€é”® Users_Idã€‚Banned è¡¨ç¤ºè¿™ä¸ªç”¨æˆ·æ˜¯å¦è¢«ç¦æ­¢ï¼ŒRole åˆ™æ˜¯ä¸€ä¸ªè¡¨ç¤ºï¼ˆâ€˜clientâ€™, â€˜driverâ€™, â€˜partnerâ€™ï¼‰çš„æšä¸¾ç±»å‹ã€‚

| Users_Id | Banned | Role   |
| :------: | :----: | :----: |
|        1 | No     | client |
|        2 | Yes    | client |
|        3 | No     | client |
|        4 | No     | client |
|       10 | No     | driver |
|       11 | No     | driver |
|       12 | No     | driver |
|       13 | No     | driver |

å†™ä¸€æ®µ SQL è¯­å¥æŸ¥å‡º 2013 å¹´10 æœˆ1æ—¥ è‡³ 2013 å¹´10 æœˆ 3 æ—¥æœŸé—´éç¦æ­¢ç”¨æˆ·çš„å–æ¶ˆç‡ã€‚åŸºäºä¸Šè¡¨ï¼Œä½ çš„ SQL è¯­å¥åº”è¿”å›å¦‚ä¸‹ç»“æœï¼Œå–æ¶ˆç‡ï¼ˆCancellation Rateï¼‰ä¿ç•™ä¸¤ä½å°æ•°ã€‚

å–æ¶ˆç‡çš„è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š(è¢«å¸æœºæˆ–ä¹˜å®¢å–æ¶ˆçš„éç¦æ­¢ç”¨æˆ·ç”Ÿæˆçš„è®¢å•æ•°é‡) / (éç¦æ­¢ç”¨æˆ·ç”Ÿæˆçš„è®¢å•æ€»æ•°)

|        Day | Cancellation Rate |
| :--------: | :---------------: |
| 2013-10-01 |              0.33 |
| 2013-10-02 |              0.00 |
| 2013-10-03 |              0.50 |

è§£é¢˜æ–¹æ³•ï¼š

```sql
SELECT T.request_at AS `Day`, 
	ROUND(
			SUM(
				IF(T.STATUS = 'completed',0,1)
			)
			/ 
			COUNT(T.STATUS),
			2
	) AS `Cancellation Rate`
FROM Trips AS T
JOIN Users AS U1 ON (T.client_id = U1.users_id AND U1.banned ='No')
JOIN Users AS U2 ON (T.driver_id = U2.users_id AND U2.banned ='No')
WHERE T.request_at BETWEEN '2013-10-01' AND '2013-10-03'
GROUP BY T.request_at
```



## 3 æ€»ç»“

é€šè¿‡è¿™ä¸€æ®µæ—¶é—´çš„ç»ƒä¹ åŸºæœ¬ç†Ÿæ‚‰äº† SQL çš„å¸¸ç”¨è¯­å¥ï¼ŒJOIN è¯­å¥å’Œçª—å£å‡½æ•°åœ¨ SQL ä¸­çš„é‡è¦æ€§ä¸è¨€è€Œå–» ã€‚åé¢æˆ‘å°†ç»§ç»­å­¦ä¹  SQL ä¸­çš„çª—å£å‡½æ•°å’Œ  JOIN è¯­å¥ï¼ŒLet's go !ğŸ˜€